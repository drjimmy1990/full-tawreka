{
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "80f0577a-415f-4985-b851-8ae8bc755f65",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
                -1632,
                2416
            ],
            "id": "47893908-ce68-486b-9184-92cf2ed105a9",
            "name": "Webhook",
            "webhookId": "80f0577a-415f-4985-b851-8ae8bc755f65"
        },
        {
            "parameters": {
                "amount": 1
            },
            "type": "n8n-nodes-base.wait",
            "typeVersion": 1.1,
            "position": [
                2704,
                2208
            ],
            "id": "af77c824-477c-4775-9e0c-f82ebdc6ddf0",
            "name": "Wait",
            "webhookId": "366bbf4c-bea5-46d1-9377-d04e859ae509"
        },
        {
            "parameters": {
                "tableId": "queue",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "sender_id",
                            "fieldValue": "={{ $('Edit Fields').item.json.SenderJid }}"
                        },
                        {
                            "fieldId": "message",
                            "fieldValue": "={{ $('Edit Fields').item.json.Msg }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                3296,
                2176
            ],
            "id": "e30ff135-a630-46bc-852c-360479262d1d",
            "name": "Create a row2",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",
                "authentication": "predefinedCredentialType",
                "nodeCredentialType": "googlePalmApi",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{\n{\n  \"contents\": [{\n    \"parts\":[\n      {\"text\": \"Transcribe this audio ØªÙ…Ø§Ù…Ø§ ÙƒÙ…Ø§ ÙŠÙ†Ø·Ù‚Ù‡Ø§\"},\n      {\"inlineData\": {\n        \"mimeType\": `audio/ogg`,\n        \"data\": $json.base64 }\n      }\n    ]\n  }]\n}\n}}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                2672,
                2384
            ],
            "id": "4fd838cc-5477-4073-bd32-5767cb226750",
            "name": "transcribe",
            "credentials": {
                "googlePalmApi": {
                    "id": "5p0YKMLaCVAAMklV",
                    "name": "Google Gemini(PaLM) Api account"
                }
            }
        },
        {
            "parameters": {
                "tableId": "queue",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "sender_id",
                            "fieldValue": "={{ $('Edit Fields').item.json.SenderJid }}"
                        },
                        {
                            "fieldId": "message",
                            "fieldValue": "={{ $json.candidates[0].content.parts[0].text }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                3296,
                2384
            ],
            "id": "cbbe32f8-4831-4821-bc91-28252d03b2d1",
            "name": "Create a row3",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "assignments": {
                    "assignments": [
                        {
                            "id": "0e8943f1-f0fd-4e02-9fd2-53b10cb838af",
                            "name": "msg_id",
                            "value": "={{ $json.id }}",
                            "type": "string"
                        },
                        {
                            "id": "f1883ec8-d649-493b-8953-c59b14a5014d",
                            "name": "sender_id",
                            "value": "={{ $json.sender_id }}",
                            "type": "string"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
                4448,
                2432
            ],
            "id": "c106a0e3-a23c-4dac-99b8-6ed7e8bb639c",
            "name": "Edit Fields4"
        },
        {
            "parameters": {
                "operation": "toBinary",
                "sourceProperty": "base64",
                "binaryPropertyName": "=data",
                "options": {
                    "fileName": "={{ $json.fileName }}"
                }
            },
            "type": "n8n-nodes-base.convertToFile",
            "typeVersion": 1.1,
            "position": [
                2784,
                2576
            ],
            "id": "2212fce8-c073-4147-89a5-92d6ad97512e",
            "name": "Convert to File2"
        },
        {
            "parameters": {
                "operation": "write",
                "fileName": "=/mnt/shared_files/{{ $binary.data.fileName }}",
                "options": {}
            },
            "type": "n8n-nodes-base.readWriteFile",
            "typeVersion": 1,
            "position": [
                3072,
                2576
            ],
            "id": "dbe77873-ee37-473d-b433-af9c3939de73",
            "name": "Read/Write Files from Disk2"
        },
        {
            "parameters": {
                "tableId": "message_queue",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "sender_id",
                            "fieldValue": "={{ $('Edit Fields').item.json.SenderJid }}"
                        },
                        {
                            "fieldId": "message",
                            "fieldValue": "={{ $json.text }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                3936,
                2560
            ],
            "id": "0a1f9fd1-5789-4e56-b337-14fee9a5d5da",
            "name": "Create a row6",
            "credentials": {
                "supabaseApi": {
                    "id": "x7vfKn8WUrMrWC2y",
                    "name": "Supabase account"
                }
            }
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "describe what you see in the image in details Ø¨Ø§Ù„Ù„ØºÙ‡ Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‡ ÙÙ‚Ø· .  Ø±Ø¯ Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØºÙ‡ : \"Ø§Ø±Ø³Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØµÙˆØ±Ù‡ Ùˆ Ù‡Ø°Ø§ ÙˆØµÙÙ‡Ø§ : ",
                "messages": {
                    "messageValues": [
                        {
                            "message": " "
                        },
                        {
                            "type": "HumanMessagePromptTemplate",
                            "messageType": "imageBinary"
                        }
                    ]
                }
            },
            "type": "@n8n/n8n-nodes-langchain.chainLlm",
            "typeVersion": 1.5,
            "position": [
                3456,
                2576
            ],
            "id": "e9473216-b49d-48b4-a1f2-8c880afed348",
            "name": "Basic LLM Chain"
        },
        {
            "parameters": {
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
            "typeVersion": 1,
            "position": [
                3216,
                2768
            ],
            "id": "d39d7ea8-8b3e-4af9-9969-836b41aa21f6",
            "name": "Google Gemini Chat Model1",
            "credentials": {
                "googlePalmApi": {
                    "id": "9tk6ar8H7jjMNwgc",
                    "name": "CHALEHAT"
                }
            }
        },
        {
            "parameters": {
                "sortFieldsUi": {
                    "sortField": [
                        {
                            "fieldName": "id"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.sort",
            "typeVersion": 1,
            "position": [
                5280,
                2432
            ],
            "id": "ab2b847b-ab9c-4e82-bde6-da110dd0db66",
            "name": "Sort"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "loose",
                        "version": 2
                    },
                    "conditions": [
                        {
                            "id": "4e2d4eee-1aaf-40d5-a6b4-0e7ee44acd1e",
                            "leftValue": "={{ $input.last().json.id }}",
                            "rightValue": "={{ $('Edit Fields4').item.json.msg_id }}",
                            "operator": {
                                "type": "string",
                                "operation": "equals",
                                "name": "filter.operator.equals"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "looseTypeValidation": true,
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
                5520,
                2448
            ],
            "id": "d10e06bd-863f-4f62-8a3a-cddfbc19b591",
            "name": "If5"
        },
        {
            "parameters": {
                "amount": 10
            },
            "type": "n8n-nodes-base.wait",
            "typeVersion": 1.1,
            "position": [
                4704,
                2432
            ],
            "id": "4ac55966-b614-475a-af05-da5e2a4e655f",
            "name": "Wait4",
            "webhookId": "56ce489b-36ae-4a92-81d2-2c17f295866a"
        },
        {
            "parameters": {
                "operation": "getAll",
                "tableId": "queue",
                "returnAll": true,
                "filters": {
                    "conditions": [
                        {
                            "keyName": "sender_id",
                            "condition": "eq",
                            "keyValue": "={{ $json.sender_id }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                4960,
                2416
            ],
            "id": "e19e5b79-5879-46eb-97aa-968d50af8093",
            "name": "Get many rows1",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "fieldsToAggregate": {
                    "fieldToAggregate": [
                        {
                            "fieldToAggregate": "message"
                        },
                        {}
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
                5936,
                2464
            ],
            "id": "d8f679a7-ebf6-426d-a3a6-885257b28e0e",
            "name": "Aggregate2"
        },
        {
            "parameters": {
                "jsCode": "return [\n  {\n    json: {\n      body: $('Aggregate2').first().json.message.join(\"  \") // Directly assign the joined string\n    }\n  }\n];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                6304,
                2464
            ],
            "id": "0628b9c9-f546-461e-83de-aee489bcc89e",
            "name": "Code6"
        },
        {
            "parameters": {
                "operation": "delete",
                "tableId": "queue",
                "matchType": "allFilters",
                "filters": {
                    "conditions": [
                        {
                            "keyName": "sender_id",
                            "condition": "eq",
                            "keyValue": "={{ $('Edit Fields4').item.json.sender_id }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                5760,
                2464
            ],
            "id": "a92b6300-b704-49e2-9ae7-82ceba9cbb24",
            "name": "Delete a row1",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {},
            "type": "n8n-nodes-base.noOp",
            "typeVersion": 1,
            "position": [
                5968,
                2752
            ],
            "id": "1c825cb9-92f3-4fb1-8200-96d3aab8d98b",
            "name": "No Operation, do nothing1"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://evo.ai4eg.com/chat/getBase64FromMediaMessage/n8n",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "={{ $('Webhook').item.json.body.apikey }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $('Webhook').item.json.body.data.key.id }}\"\n    }\n  }\n} ",
                "options": {
                    "response": {}
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                2512,
                2576
            ],
            "id": "6c32443f-7ffd-42f7-bbdc-45522accfc51",
            "name": "HTTP Request8"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                    },
                    "conditions": [
                        {
                            "id": "8d1b3ac2-3c0b-4de9-9a6e-1962d31419ae",
                            "leftValue": "={{ $json.body.data.messageType }}",
                            "rightValue": "=stickerMessage",
                            "operator": {
                                "type": "string",
                                "operation": "equals"
                            }
                        },
                        {
                            "id": "b3b22bac-19c4-4913-bf5c-d9e84e40c196",
                            "leftValue": "={{ $json.body.data.key.fromMe }}",
                            "rightValue": "true",
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "or"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
                -976,
                2320
            ],
            "id": "1ae1a530-a67e-4b4f-98a5-d163e26cdfb5",
            "name": "If"
        },
        {
            "parameters": {},
            "type": "n8n-nodes-base.noOp",
            "typeVersion": 1,
            "position": [
                -432,
                2064
            ],
            "id": "6b6e783f-4a4f-4246-be6f-cc1ceab9be4e",
            "name": "No Operation, do nothing"
        },
        {
            "parameters": {
                "assignments": {
                    "assignments": [
                        {
                            "id": "0fceb1bb-c0de-4e6c-880f-062704739f1e",
                            "name": "SenderJid",
                            "value": "={{ $json.SenderJid }}",
                            "type": "string"
                        },
                        {
                            "id": "04ac662e-9deb-4d63-ac8f-cafab77e0f7b",
                            "name": "SenderName",
                            "value": "={{ $json.SenderName }}",
                            "type": "string"
                        },
                        {
                            "id": "f812ad17-d60f-4c5d-b1d4-7820238fe0e3",
                            "name": "Timestamp",
                            "value": "={{$('Webhook').item.json.body.data.messageTimestamp.toDateTime('s').setZone('UTC+2') }}",
                            "type": "string"
                        },
                        {
                            "id": "3c3fdb3c-de14-4bcc-8d9a-68cc2ed0d1c8",
                            "name": "MsgType",
                            "value": "={{ $json.MsgType }}",
                            "type": "string"
                        },
                        {
                            "id": "e0595c23-53c7-4eb9-aea2-4de3fa76e7db",
                            "name": "Msg",
                            "value": "={{ $json.Msg }}",
                            "type": "string"
                        },
                        {
                            "id": "5f1ca696-9ad5-4f22-accd-435a5c8c6ced",
                            "name": "Media",
                            "value": "={{ $json.body.data.message.base64 }}",
                            "type": "string"
                        },
                        {
                            "id": "eb5b8516-cc5f-43b3-a578-2d8b15b7b51d",
                            "name": "Instance",
                            "value": "={{ $json.Instance }}",
                            "type": "string"
                        },
                        {
                            "id": "8c6ec75c-45c6-44de-a860-84baa4832602",
                            "name": "Key",
                            "value": "={{ $json.Key }}",
                            "type": "string"
                        },
                        {
                            "id": "08edec4e-32c4-466d-8d66-261a8ede1abc",
                            "name": "phonenumber",
                            "value": "={{ $json.phonenumber }}",
                            "type": "string"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
                -256,
                2336
            ],
            "id": "697d9f02-ece1-4ec5-97b8-207e382cbff0",
            "name": "Edit Fields"
        },
        {
            "parameters": {
                "operation": "get",
                "tableId": "customers",
                "filters": {
                    "conditions": [
                        {
                            "keyName": "phone_number",
                            "keyValue": "={{ $json.phonenumber }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                -816,
                2656
            ],
            "id": "9cb56c15-39b9-483b-a5b3-b36a6a6f4e79",
            "name": "Get a row",
            "alwaysOutputData": true,
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 3
                    },
                    "conditions": [
                        {
                            "id": "ec0bf8b4-26e6-4b8f-8f02-dde4964ef239",
                            "leftValue": "={{ $json.result.found }}",
                            "rightValue": "",
                            "operator": {
                                "type": "boolean",
                                "operation": "false",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
                416,
                2336
            ],
            "id": "c7764fcd-0661-4536-813e-df7507beb30a",
            "name": "If1"
        },
        {
            "parameters": {
                "tableId": "customers",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "phone_number",
                            "fieldValue": "={{ $('Edit Fields').item.json.phonenumber }}"
                        },
                        {
                            "fieldId": "full_name",
                            "fieldValue": "={{ $('Edit Fields').item.json.SenderName }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                704,
                2128
            ],
            "id": "db56e313-485e-49cb-bcad-c981b8392bbd",
            "name": "Create a row",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "rules": {
                    "values": [
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 2
                                },
                                "conditions": [
                                    {
                                        "id": "f7206c20-c422-47d0-a11c-437e11473683",
                                        "leftValue": "={{ $('Edit Fields').item.json.MsgType }}",
                                        "rightValue": "conversation",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "Text"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 2
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{ $('Edit Fields').item.json.MsgType }}",
                                        "rightValue": "audioMessage",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        },
                                        "id": "9e64d812-9b40-494f-9c7c-eafb670f18e7"
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "audio"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 2
                                },
                                "conditions": [
                                    {
                                        "id": "c2c4a950-10f3-4d58-84a8-dba2dfc64741",
                                        "leftValue": "={{ $('Edit Fields').item.json.MsgType }}",
                                        "rightValue": "imageMessage",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "Image"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 2
                                },
                                "conditions": [
                                    {
                                        "id": "80a51bdb-266a-4c52-b436-a488476c0803",
                                        "leftValue": "={{ $('Edit Fields').item.json.MsgType }}",
                                        "rightValue": "=documentMessage",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "Document"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 2
                                },
                                "conditions": [
                                    {
                                        "id": "489dc6f5-fc53-4053-99ef-8bb07f79c48d",
                                        "leftValue": "={{ $('Edit Fields').item.json.MsgType }}",
                                        "rightValue": "=locationMessage",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "Location"
                        }
                    ]
                },
                "options": {
                    "fallbackOutput": "extra"
                }
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
                1136,
                2288
            ],
            "id": "ba0a847f-1304-40cb-96a3-a684ad5a1e60",
            "name": "Switch"
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "=CUSTOMER MESSAGE: {{ $json.user_message }}",
                "needsFallback": true,
                "options": {
                    "systemMessage": "=\n\n### 1. IDENTITY & PERSONA\nYou are **'TawrekaBot'**, the intelligent, witty, and friendly head waiter for **Tawreka Restaurant (ØªÙˆØ±ÙŠÙ‚Ù‡)**.\nYour mission is to guide customers through a delightful ordering experience, manage delivery logistics, and ensure order accuracy. Always speak in **Egyptian Arabic** language.\n\n**Personality & Tone:**\n- **Warm & Egyptian:** You speak like a polite \"Ibn Balad\". You are professional but use Egyptian charm.\n- **Languages:** Fluent in **Egyptian Arabic** (Franco or Arabic Script) and **English**.\n- **Adaptability:** Always mirror the user's language. If they speak Arabic, reply in Arabic.\n- **Emoji Usage:** Use emojis frequently to keep the mood light but don't use too many emojis, 1 to 3 at most in the message. (ğŸ¥, ğŸ¯, ğŸ›µ, â¤ï¸, ğŸ“, ğŸ“).\n\n### 2. THE PRIME DIRECTIVE (NON-NEGOTIABLE)\n1.  **JSON ONLY:** You are an API endpoint in the form of a chatbot. You must **NEVER** output conversational text outside of the JSON structure.\n2.  **NO MARKDOWN:** Do not use code blocks (like ```json). Output raw, parseable JSON only.\n3.  **ALWAYS ENGAGE:** Your `reply_to_user` must **ALWAYS** end with a question, a suggestion, or a call-to-action (unless the order is finalized).\n4.  **CONTEXT AWARENESS:** You must read the `DYNAMIC CONTEXT FROM DATABASE` provided at the bottom of this prompt before every response.\n5.  **MENU:** Be restricted to our menu items, never mention dishes or additions we don't have in our menu.\n6.  **PRICE VISIBILITY (CRITICAL):** Do **NOT** mention prices when listing items or suggesting food unless the user **explicitly asks** for the price (e.g., \"bkam?\", \"how much?\"). However, you **MUST** show the individual and total prices in the **Revision Phase** (The bill).\n7.  **CRITICAL RULES:** You must only respond to topics directly related to our restaurant, including menu items, reservations, opening hours, location, services, promotions, and customer inquiries. You must politely refuse to answer or redirect any questions that are not related to the restaurant.\n8.  If someone asked from where you knew the name, it's from the WhatsApp profile.\n\n\n\n\n\n#### **B. MENU ITEMS & PRICES**\n\nOf course. Here is the complete and detailed menu, transcribed and formatted from the text you provided. I have made sure to include every item, description, price, and special tag.\n\n---\n\n## ÙØ·Ø§Ø¦Ø± Ù„Ø­ÙˆÙ… (Meat Feteer)\n\n### ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ Ø¬Ø¨Ù†Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 145\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 195\n  - Ù…ÙŠØ¯ÙŠÙ…: 215\n  - Ù„Ø§Ø±Ø¬: 315\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 425\n\n### ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 165\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 200\n  - Ù…ÙŠØ¯ÙŠÙ…: 235\n  - Ù„Ø§Ø±Ø¬: 335\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 465\n\n### ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 165\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 200\n  - Ù…ÙŠØ¯ÙŠÙ…: 235\n  - Ù„Ø§Ø±Ø¬: 335\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 465\n\n### ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Signature\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 190\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 275\n  - Ù„Ø§Ø±Ø¬: 395\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 485\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ù…ÙŠØª\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø³Ù„Ø§Ù…ÙŠ - Ù‡ÙˆØª Ø¯ÙˆØ¬ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 175\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 375\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 480\n\n### ÙØ·ÙŠØ±Ø© Ù…Ø´Ù†ÙƒØ§Ø­\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - Ù„Ø­Ù… Ù…ÙØ±ÙˆÙ… - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 185\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 375\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 480\n\n### ÙØ·ÙŠØ±Ø© Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø¨Ø³Ø·Ø±Ù…Ø© - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 170\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 200\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ù„Ø§Ø±Ø¬: 360\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 460\n\n---\n\n## ÙØ·Ø§Ø¦Ø± Ø¯Ø¬Ø§Ø¬ (Chicken Feteer)\n\n### ÙØ·ÙŠØ±Ø© ÙØ±Ø§Ø® Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® - Ø¨Ø³Ø·Ø±Ù…Ø© - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ù„Ø§Ø±Ø¬: 390\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙŠÙ„Ø§Ù†Ùˆ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® - Ø³Ù„Ø§Ù…ÙŠ - Ù…Ø´Ø±ÙˆÙ… - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 190\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ù„Ø§Ø±Ø¬: 425\n\n### ÙØ·ÙŠØ±Ø© Ø´ÙŠØ´ Ø·Ø§ÙˆÙˆÙ‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® Ø´ÙŠØ´ Ø·Ø§ÙˆÙˆÙ‚ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 145\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 180\n  - Ù…ÙŠØ¯ÙŠÙ…: 225\n  - Ù„Ø§Ø±Ø¬: 325\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 425\n\n### ÙØ·ÙŠØ±Ø© ØªØ´ÙƒÙ† Ø±Ø§Ù†Ø´\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® Ù…ØªØ¨Ù„ Ø¨ØµÙˆØµ Ø§Ù„Ø±Ø§Ù†Ø´ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 165\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 365\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© Ø¯Ø¬Ø§Ø¬ ÙƒØ±ÙŠÙ…ÙŠ ØªØ´ÙŠØ²\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® Ù…ØªØ¨Ù„ Ø¨ØµÙˆØµ Ø§Ù„Ø¨Ø§Ø±Ø¨ÙƒÙŠÙˆ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 495\n\n### ÙØ·ÙŠØ±Ø© ØªØ´ÙƒÙ† Ø¨Ø§Ø±Ø¨ÙƒÙŠÙˆ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® Ù…ØªØ¨Ù„ Ø¨ØµÙˆØµ Ø§Ù„Ø¨Ø§Ø±Ø¨ÙƒÙŠÙˆ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 160\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 365\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© ØªØ´ÙƒÙ† ÙƒØ±ÙŠØ³Ø¨Ù‰\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 165\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 190\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ù„Ø§Ø±Ø¬: 350\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© ØªØ´ÙƒÙ† Ø²Ù†Ø¬Ø±\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Spicy\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ Ø­Ø§Ø± - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 175\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 195\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 355\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 380\n\n### ÙØ·ÙŠØ±Ø© Ø³ÙˆØ¨Ø± ÙƒØ±Ø§Ù†Ø´ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ - ØªØ±ÙƒÙŠ Ù…Ø¯Ø®Ù† - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 190\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 360\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 490\n\n### ÙØ·ÙŠØ±Ø© Ø³ÙˆØ¨Ø± Ø³Ø¨Ø±ÙŠÙ…\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ - ØªØ±ÙƒÙŠ Ù…Ø¯Ø®Ù† - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 190\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 255\n  - Ù„Ø§Ø±Ø¬: 360\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 490\n\n### ÙØ·ÙŠØ±Ø© ÙƒÙˆØ±Ø¯Ù† Ø¨Ù„Ùˆ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ - Ø±ÙˆØ²Ø¨ÙŠÙ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 195\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 240\n  - Ù„Ø§Ø±Ø¬: 360\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 490\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ø¬Ø¨Ù† ÙƒØ±ÙŠØ³Ø¨Ù‰\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Best Seller\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ - Ø¬Ø¨Ù†Ø© ÙƒØ±ÙŠÙ…ÙŠ - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 175\n  - Ù…ÙŠØ¯ÙŠÙ…: 260\n  - Ù„Ø§Ø±Ø¬: 375\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ø¬Ø¨Ù† Ø²Ù†Ø¬Ø±\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª:** Spicy - Best Seller\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙƒØ±ÙŠØ³Ø¨Ù‰ Ø­Ø§Ø± - Ø¬Ø¨Ù†Ø© ÙƒØ±ÙŠÙ…ÙŠ - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 175\n  - Ù…ÙŠØ¯ÙŠÙ…: 260\n  - Ù„Ø§Ø±Ø¬: 375\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ø¯Ø¬Ø§Ø¬\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® ÙØ§Ù‡ÙŠØªØ§ - Ø´ÙŠØ´ Ø·Ø§ÙˆÙˆÙ‚ - ÙƒØ±ÙŠØ³Ø¨Ù‰ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 195\n  - Ù…ÙŠØ¯ÙŠÙ…: 300\n\n---\n\n## ÙØ·Ø§Ø¦Ø± Ø³ÙŠ ÙÙˆØ¯ (Seafood Feteer)\n\n### ÙØ·ÙŠØ±Ø© ØªÙˆÙ†Ø© Ù‚Ø·Ø¹\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ØªÙˆÙ†Ø© Ù‚Ø·Ø¹ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 175\n  - Ù…ÙŠØ¯ÙŠÙ…: 330\n  - Ù„Ø§Ø±Ø¬: 460\n\n### ÙØ·ÙŠØ±Ø© Ø¬Ù…Ø¨Ø±ÙŠ Ø±Ø§Ù†Ø´\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø¬Ù…Ø¨Ø±ÙŠ - ÙƒØ§Ø¨ÙˆØ±ÙŠØ§ Ø£ØµØ§Ø¨Ø¹ - ØµÙˆØµ Ø±Ø§Ù†Ø´ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 210\n  - Ù…ÙŠØ¯ÙŠÙ…: 350\n  - Ù„Ø§Ø±Ø¬: 550\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 700\n\n### ÙØ·ÙŠØ±Ø© Ø³ÙŠ Ø±Ø§Ù†Ø´\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø¬Ù…Ø¨Ø±ÙŠ - ÙƒØ§Ø¨ÙˆØ±ÙŠØ§ Ø£ØµØ§Ø¨Ø¹ - ØµÙˆØµ Ø±Ø§Ù†Ø´ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 200\n  - Ù…ÙŠØ¯ÙŠÙ…: 330\n  - Ù„Ø§Ø±Ø¬: 460\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 590\n\n---\n\n## ÙØ·Ø§Ø¦Ø± Ø¬Ø¨Ù† (Cheese Feteer)\n\n### ÙØ·ÙŠØ±Ø© Ø¬Ø¨Ù†Ø© Ø±ÙˆÙ…ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 120\n  - Ù…ÙŠØ¯ÙŠÙ…: 175\n  - Ù„Ø§Ø±Ø¬: 245\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 385\n\n### ÙØ·ÙŠØ±Ø© Ø¬Ø¨Ù†Ø© Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 120\n  - Ù…ÙŠØ¯ÙŠÙ…: 185\n  - Ù„Ø§Ø±Ø¬: 245\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 385\n\n### ÙØ·ÙŠØ±Ø© Ø¬Ø¨Ù†Ø© ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒÙŠØ±ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 155\n  - Ù…ÙŠØ¯ÙŠÙ…: 230\n  - Ù„Ø§Ø±Ø¬: 325\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 435\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ø¬Ø¨Ù†\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Must try\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - Ø´ÙŠØ¯Ø± Ø£Ø­Ù…Ø± - Ø´ÙŠØ¯Ø± Ø£ØµÙØ± - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ø±ÙˆÙ„: 170\n  - Ø¥ÙƒØ³ØªØ±Ø§ Ø±ÙˆÙ„: 200\n  - Ù…ÙŠØ¯ÙŠÙ…: 240\n  - Ù„Ø§Ø±Ø¬: 335\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 450\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ø¬Ø¨Ù† ÙˆØ³Ø¬Ù‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - Ø´ÙŠØ¯Ø± Ø£Ø­Ù…Ø± - Ø´ÙŠØ¯Ø± Ø£ØµÙØ± - Ø³Ø¬Ù‚ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ù„Ø§Ø±Ø¬: 350\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 485\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³ Ø¬Ø¨Ù† ÙˆØ¨Ø³Ø·Ø±Ù…Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - Ø´ÙŠØ¯Ø± Ø£Ø­Ù…Ø± - Ø´ÙŠØ¯Ø± Ø£ØµÙØ± - Ø¨Ø³Ø·Ø±Ù…Ø© - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ù„Ø§Ø±Ø¬: 350\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 485\n\n---\n\n## Ù†Øµ ÙˆÙ†Øµ (Half & Half)\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ Ø³Ø¬Ù‚ ÙˆÙ†Øµ Ø¨Ø³Ø·Ø±Ù…Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø³Ø¹Ø±:** Ø¹Ø§Ø¦Ù„ÙŠ: 425\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ Ù…Ø´ÙƒÙ„ Ù„Ø­ÙˆÙ… ÙˆÙ†Øµ Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - Ù„Ø­Ù…Ø© Ù…ÙØ±ÙˆÙ… - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙƒÙŠØ±ÙŠ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø³Ø¹Ø±:** Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ Ø¯Ø¬Ø§Ø¬ Ø±Ø§Ù†Ø´ ÙˆÙ†Øµ Ø¨Ø§Ø±Ø¨ÙƒÙŠÙˆ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® Ù…ØªØ¨Ù„Ø© Ø¨ØµÙˆØµ Ø±Ø§Ù†Ø´ - ØµÙˆØµ Ø¨Ø§Ø±Ø¨ÙƒÙŠÙˆ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙƒÙŠØ±ÙŠ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:**\n  - Ù…ÙŠØ¯ÙŠÙ…: 250\n  - Ø¹Ø§Ø¦Ù„ÙŠ: 475\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ Ø³Ø¬Ù‚ ÙƒÙŠØ±ÙŠ ÙˆÙ†Øµ Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø³Ø¹Ø±:** Ø¹Ø§Ø¦Ù„ÙŠ: 450\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ Ù…ÙƒØ³ Ø¬Ø¨Ù† ÙƒØ±ÙŠØ³Ø¨Ù‰ ÙˆÙ†Øµ Ù…ÙƒØ³ Ø¬Ø¨Ù† Ø²Ù†Ø¬Ø±\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Semi Spicy\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒØ±ÙŠØ³Ø¨Ù‰ Ø¨Ø§Ø±Ø¯ - ÙƒØ±ÙŠØ³Ø¨Ù‰ Ø­Ø§Ø± - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø³Ø¹Ø±:** Ø¹Ø§Ø¦Ù„ÙŠ: 485\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ ØªØ´ÙŠÙƒÙ† Ø³ÙˆØ¨Ø± Ø³Ø¨Ø±ÙŠÙ… ÙˆÙ†Øµ ØªØ´ÙŠÙƒÙ† Ø³ÙˆØ¨Ø± ÙƒØ±Ø§Ù†Ø´ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒØ±ÙŠØ³Ø¨Ù‰ Ø¨Ø§Ø±Ø¯ - ØªØ±ÙƒÙŠ Ù…Ø¯Ø®Ù† - Ø³Ù„Ø§Ù…Ù‰ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø³Ø¹Ø±:** Ø¹Ø§Ø¦Ù„ÙŠ: 495\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ ØªØ´ÙŠÙƒÙ† Ø±Ø§Ù†Ø´ ÙˆÙ†Øµ Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ±Ø§Ø® Ù…ØªØ¨Ù„Ø© Ø¨ØµÙˆØµ Ø±Ø§Ù†Ø´ - Ø³Ø¬Ù‚ - Ø¨Ø³Ø·Ø±Ù…Ø© - ÙƒÙŠØ±ÙŠ - Ø±ÙˆÙ…ÙŠ - Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ - ÙÙ„ÙÙ„ - Ø®ÙŠØ§Ø± Ù…Ø®Ù„Ù„\n- **Ø§Ù„Ø³Ø¹Ø±:** Ø¹Ø§Ø¦Ù„ÙŠ: 510\n\n---\n\n## ÙØ·Ø§Ø¦Ø± Ø­Ù„Ùˆ (Sweet Feteer)\n\n### ÙØ·ÙŠØ±Ø© ØªÙØ§Ø­ ÙˆÙ‚Ø±ÙØ©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ØªÙØ§Ø­ - Ù‚Ø±ÙØ© - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 85, Ù…ÙŠØ¯ÙŠÙ…: 140\n\n### ÙØ·ÙŠØ±Ø© Ù‚Ø´Ø·Ø© ÙˆØ¨Ø³Ø¨ÙˆØ³Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù‚Ø´Ø·Ø© - Ø¨Ø³Ø¨ÙˆØ³Ø© - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 110, Ù…ÙŠØ¯ÙŠÙ…: 175\n\n### ÙØ·ÙŠØ±Ø© Ù†ÙˆØªÙŠÙ„Ø§ Ù„ÙˆØªØ³\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Best Seller\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù†ÙˆØªÙŠÙ„Ø§ - Ù„ÙˆØªØ³ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 120, Ù…ÙŠØ¯ÙŠÙ…: 210\n\n### ÙØ·ÙŠØ±Ø© Ù†ÙˆØªÙŠÙ„Ø§\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù†ÙˆØªÙŠÙ„Ø§ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 130, Ù…ÙŠØ¯ÙŠÙ…: 195\n\n### ÙØ·ÙŠØ±Ø© ÙƒÙ†Ø¯Ø±\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒÙ†Ø¯Ø± - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 85, Ù…ÙŠØ¯ÙŠÙ…: 130\n\n### ÙØ·ÙŠØ±Ø© Ù†ÙˆØªÙŠÙ„Ø§ Ù…ÙƒØ³Ø±Ø§Øª\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Best Seller\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù†ÙˆØªÙŠÙ„Ø§ - Ø¨Ù†Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ÙØ³Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 185, Ù…ÙŠØ¯ÙŠÙ…: 265\n\n### ÙØ·ÙŠØ±Ø© ÙØ³Ø¯Ù‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ØµÙˆØµ ÙØ³Ø¯Ù‚ - ÙØ³Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 170, Ù…ÙŠØ¯ÙŠÙ…: 285\n\n### ÙØ·ÙŠØ±Ø© Ù†ÙˆØªÙŠÙ„Ø§ ÙØ³Ø¯Ù‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ØµÙˆØµ ÙØ³Ø¯Ù‚ - ÙØ³Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - Ù†ÙˆØªÙŠÙ„Ø§ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 170, Ù…ÙŠØ¯ÙŠÙ…: 265\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙŠÙƒØ³ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨ÙŠØ¶Ø§ - Ù†ÙˆØªÙŠÙ„Ø§ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 155, Ù…ÙŠØ¯ÙŠÙ…: 245\n\n### ÙØ·ÙŠØ±Ø© Ø¯Ø¨ÙŠ\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Trend\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ØµÙˆØµ ÙØ³Ø¯Ù‚ - Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ÙˆØ§ÙŠØª - Ù†ÙˆØªÙŠÙ„Ø§ - ÙƒÙ†Ø§ÙØ© - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 250\n\n### ÙØ·ÙŠØ±Ø© Ù†ÙˆØªÙŠÙ„Ø§ Ø¨Ù†Ø¯Ù‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù†ÙˆØªÙŠÙ„Ø§ - Ø¨Ù†Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 150, Ù…ÙŠØ¯ÙŠÙ…: 250\n\n### ÙØ·ÙŠØ±Ø© Ù†ÙˆØªÙŠÙ„Ø§ Ù…ÙˆØ²\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù†ÙˆØªÙŠÙ„Ø§ - Ù…ÙˆØ² - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 140, Ù…ÙŠØ¯ÙŠÙ…: 220\n\n### ÙØ·ÙŠØ±Ø© Ù„ÙˆØªØ³\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù„ÙˆØªØ³ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 100, Ù…ÙŠØ¯ÙŠÙ…: 175\n\n### ÙØ·ÙŠØ±Ø© Ù„ÙˆØªØ³ Ù‚Ø´Ø·Ø©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù„ÙˆØªØ³ - Ù‚Ø´Ø·Ø© - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 120, Ù…ÙŠØ¯ÙŠÙ…: 175\n\n### ÙØ·ÙŠØ±Ø© Ø³ÙƒØ± ÙˆÙ„Ø¨Ù†\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Best Seller\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - Ù„Ø¨Ù† - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 60, Ù…ÙŠØ¯ÙŠÙ…: 85\n\n### ÙØ·ÙŠØ±Ø© Ø¨ØºØ§Ø´Ø©\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Best Seller\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - Ù„Ø¨Ù† - Ù…ÙƒØ³Ø±Ø§Øª - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 110\n\n### ÙØ·ÙŠØ±Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - Ø¬ÙˆØ² Ù‡Ù†Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 120\n\n### ÙØ·ÙŠØ±Ø© ÙƒØ§Ø³ØªØ±Ø¯\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - ÙƒØ§Ø³ØªØ±Ø¯ - Ù„Ø¨Ù† - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 85, Ù…ÙŠØ¯ÙŠÙ…: 115\n\n### ÙØ·ÙŠØ±Ø© Ø¨ØºØ§Ø´Ø© Ø§Ù„Ø£Ø³ÙˆØ§Ù†ÙŠ\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - ÙƒØ§Ø³ØªØ±Ø¯ - Ù„Ø¨Ù† Ù…ÙƒØ«Ù - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 170\n\n### ÙØ·ÙŠØ±Ø© Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù‚Ø´Ø·Ø© - Ø¹Ø³Ù„ - Ù„Ø¨Ù† - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 100, Ù…ÙŠØ¯ÙŠÙ…: 135\n\n### ÙØ·ÙŠØ±Ø© Ø¨Ù„Ø­ Ø¥Ø¨Ø±ÙŠÙ…\n- **Ø§Ù„Ø¹Ù„Ø§Ù…Ø©:** Ø§Ø®ØªØ±Ø§Ø¹ (Invention)\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù„ÙˆØ² - Ù‚Ø´Ø·Ø© ÙƒØ±ÙŠÙ…ÙŠ - Ø¨Ù„Ø­ - Ø¹Ø³Ù„ - Ù„Ø¨Ù† - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 120, Ù…ÙŠØ¯ÙŠÙ…: 170\n\n### ÙØ·ÙŠØ±Ø© Ø³ÙƒØ±\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 75\n\n### ÙØ·ÙŠØ±Ø© Ù‚Ø´Ø·Ø© Ø³ÙƒØ± (Different from Qeshta Asal)\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø³ÙƒØ± - Ù‚Ø´Ø·Ø© - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 95, Ù…ÙŠØ¯ÙŠÙ…: 130\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙˆØ²\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ù…ÙˆØ² - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 120\n\n### ÙØ·ÙŠØ±Ø© ÙƒÙ†Ø§ÙØ©\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒÙ†Ø§ÙØ© - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 120\n\n### ÙØ·ÙŠØ±Ø© Ù…ÙƒØ³Ø±Ø§Øª\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ³Ø¯Ù‚ Ùˆ Ø¨Ù†Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - Ø¬ÙˆØ² Ù‡Ù†Ø¯ - Ø²Ø¨ÙŠØ¨ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 135, Ù…ÙŠØ¯ÙŠÙ…: 235\n\n### ÙØ·ÙŠØ±Ø© Ø²Ø¨ÙŠØ¨ ÙˆØ¬ÙˆØ² Ù‡Ù†Ø¯\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙƒØ§Ø³ØªØ±Ø¯ - Ø³ÙƒØ± - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø³Ø¹Ø±:** Ù…ÙŠØ¯ÙŠÙ…: 165\n\n### ÙØ·ÙŠØ±Ø© Ø¨Ù†Ø¯Ù‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** Ø¨Ù†Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ØµÙˆØµ Ø¨Ù†Ø¯Ù‚ - ÙƒØ§Ø³ØªØ±Ø¯ - Ø³Ù…Ù†Ø© Ø¨Ù„Ø¯ÙŠ\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 130, Ù…ÙŠØ¯ÙŠÙ…: 235\n\n### ÙØ·ÙŠØ±Ø© Ù†Øµ Ø¨Ù†Ø¯Ù‚ ÙˆÙ†Øµ ÙØ³ØªÙ‚\n- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:** ÙØ³Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ØµÙˆØµ ÙØ³Ø¯Ù‚ - Ø¨Ù†Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´ - ØµÙˆØµ Ø¨Ù†Ø¯Ù‚\n- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:** Ø±ÙˆÙ„: 160, Ù…ÙŠØ¯ÙŠÙ…: 290\n\n---\n\n## Ø¨ÙˆÙƒØ³Ø§Øª ØªÙˆØ±ÙŠÙ‚Ø© (Touriqa Boxes)\n*ÙŠÙÙ‚Ø¯Ù‘ÙÙ… Ù…Ø¹ Ø¨Ø·Ø§Ø·Ø³ ÙˆÙ„ØªØ± ÙƒÙˆÙ„Ø§.*\n\n### Ø¨ÙˆÙƒØ³ Ø§Ù„Ù…ÙƒØ³Ø§Øª 15 Ù‚Ø·Ø¹Ø©\n- **Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª:** Ù¥ Ù‚Ø·Ø¹ Ù…ÙƒØ³ Ø¬Ø¨Ù† â€“ Ù¥ Ù‚Ø·Ø¹ Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ â€“ Ù¥ Ù‚Ø·Ø¹ Ø¯Ø¬Ø§Ø¬ Ø±Ø§Ù†Ø´\n- **Ø§Ù„Ø³Ø¹Ø±:** 450\n\n### Ø¨ÙˆÙƒØ³ Ø§Ù„Ù…ÙƒØ³Ø§Øª 20 Ù‚Ø·Ø¹Ø©\n- **Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª:** Ù¥ Ù‚Ø·Ø¹ Ù…ÙƒØ³ Ø¬Ø¨Ù† â€“ Ù¥ Ù‚Ø·Ø¹ Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ â€“ Ù¥ Ù‚Ø·Ø¹ Ù…Ø´Ù†ÙƒØ§Ø­ â€“ Ù¥ Ù‚Ø·Ø¹ Ù…ÙƒØ³ Ù…ÙŠØª\n- **Ø§Ù„Ø³Ø¹Ø±:** 600\n\n### Ø¨ÙˆÙƒØ³ Ø§Ù„Ù…ÙƒØ³Ø§Øª 25 Ù‚Ø·Ø¹Ø©\n- **Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª:** Ù¥ Ù‚Ø·Ø¹ Ù…ÙƒØ³ Ø¬Ø¨Ù† â€“ Ù¥ Ù‚Ø·Ø¹ Ø³Ø¬Ù‚ Ø¨Ø³Ø·Ø±Ù…Ø© ÙƒÙŠØ±ÙŠ â€“ Ù¥ Ù‚Ø·Ø¹ Ù…Ø´Ù†ÙƒØ§Ø­ â€“ Ù¥ Ù‚Ø·Ø¹ Ù…ÙƒØ³ Ù…ÙŠØª - Ù¥ Ù‚Ø·Ø¹ Ø¯Ø¬Ø§Ø¬ Ø±Ø§Ù†Ø´\n- **Ø§Ù„Ø³Ø¹Ø±:** 750\n\n---\n\n## Ù…Ø´Ù„ØªØª ØªÙˆØ±ÙŠÙ‚Ø© (Touriqa Meshaltet)\n*Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØºÙ…ÙˆØ³: Ø¬Ø¨Ù†Ø© Ù‚Ø¯ÙŠÙ… - Ø¹Ø³Ù„ Ø£Ø¨ÙŠØ¶ - Ø¹Ø³Ù„ Ø£Ø³ÙˆØ¯ - Ù‚Ø´Ø·Ø© Ø¨Ù„Ø¯ÙŠ - Ø·Ø­ÙŠÙ†Ø©*\n\n- **Ù£ Ù‚Ø·Ø¹ Ù…Ø´Ù„ØªØª + Ù¢ ØºÙ…ÙˆØ³ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ:** 110\n- **ÙØ·ÙŠØ±Ø© Ù…Ø´Ù„ØªØª ÙˆØ³Ø· + 3 ØºÙ…ÙˆØ³ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ:** 135\n- **ÙØ·ÙŠØ±Ø© Ù…Ø´Ù„ØªØª ÙƒØ¨ÙŠØ±Ø© + 4 ØºÙ…ÙˆØ³ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ:** 250\n- **ÙØ·ÙŠØ±Ø© Ø¹Ø§Ø¦Ù„ÙŠ Ù…Ø´Ù„ØªØª + 5 ØºÙ…ÙˆØ³ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ:** 350\n\n---\n\n## Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª (Drinks)\n\n- **Ù…ÙŠØ§Ù‡:** 10\n- **Ù…Ø´Ø±ÙˆØ¨Ø§Øª ØºØ§Ø²ÙŠØ©:** 30\n- **Ø±ÙŠØ¯ Ø¨Ù„:** 60\n- **Ø¨Ø±Ø§Ø¯ Ø´Ø§ÙŠ:** 30 (Not available for Delivery)\n\n\n### 3. THE ONBOARDING & ORDER FLOW (STRICT SEQUENCE)\nFollow these phases linearly. Do not skip steps.\n\n1.  **Phase 1: Identification**\n    - Check Context: Is the customer's name known?\n    - Action: If unknown, ask for their name politely.\n\n2.  **Phase 2: Negotiation & Ordering (The Menu)**\n    - **Action:** Discuss menu items and help the user build their order.\n    - **Rule:** Do **NOT** ask for the address yet. Focus on the food.\n    - **Price Rule:** Describe the items deliciously but **hide the price** unless the customer asks \"How much?\".\n    - **Upsell:** Politely suggest additions (e.g., \"Te7eb tezawed Pepsi?\").\n\n3.  **Phase 3: Location & Address Selection**\n    - **Trigger:** When the user indicates they are done ordering (e.g., \"That's all\", \"Done\", \"Tamam\", \"kefaya keda\").\n    - **Check Context:** Is there a selected address?\n    - **Scenario A (No Address):** Ask for a **Location Pin** or **Google Maps Link**. Do not rely on vague descriptions.\n    - **Scenario B (Saved Addresses exist):** List the saved addresses found in the context (e.g., \"Home\", \"Work\") and ask the user to **select one**.\n\n4.  **Phase 4: The Revision (The Gatekeeper)**\n    - **Trigger:** Once the Address is defined AND the Food is selected.\n    - **Action:** You MUST summarize the full order.\n    - **Requirement:** NOW you must show the **Price of each item** and the **Total Price** (Bill).\n    - **End with:** \"Is this correct?\" or \"Confirm order?\"\n\n5.  **Phase 5: Confirmation**\n    - **Trigger:** Only when the user explicitly says \"Yes\" or \"Confirm\" to the Phase 4 summary.\n    - **Action:** Output the `CONFIRM_ORDER` intent.\n\n### 4. MODIFICATION LOGIC (STRICT FLOW)\n**Current Problem:** Do not trigger a modification intent just because the user *asks* to change something.\n**The Fix:** You must handle the negotiation via `GENERAL_QUERY` first.\n\n**Step-by-Step Modification Process:**\n1.  **Check Status:** Look at `ACTIVE ORDER STATUS` in the context.\n    - If `out_for_delivery`, `done`, or `cancelled`: **REFUSE** politely. (Intent: `GENERAL_QUERY`).\n    - If `pending`, `accepted`, or `in_kitchen`: **PROCEED**.\n2.  **Negotiation (Intent: `GENERAL_QUERY`):**\n    - User: \"I want to change order #50.\"\n    - You: \"Sure! What would you like to add or remove?\" (Do NOT output `MODIFY_ORDER` yet).\n3.  **Recalculation (Intent: `GENERAL_QUERY`):**\n    - User: \"Add a Pepsi.\"\n    - You: \"Okay, I'm adding 1 Pepsi. The new total is [Price]. Confirm this change?\" (Do NOT output `MODIFY_ORDER` yet).\n4.  **Final Execution (Intent: `MODIFY_ORDER`):**\n    - User: \"Yes, confirm.\"\n    - **NOW** you output the `MODIFY_ORDER` intent with the finalized data.\n\n### 5. KNOWLEDGE BASE & MENU (SOURCE OF TRUTH)\n\n#### **A. Branches & Contact**\n- **Phone:** 0248832036 (Unified Number).\n- **Mansoura Branch:** 1st Tor3a St, opposite Mansoura Univ. (Link: https://maps.app.goo.gl/pf4DMxppTh3y1YuG7)\n- **Almaza (Cairo) Branch:** Almaza Park Mall. (Link: https://maps.app.goo.gl/KnP6pzFdczjHPZxs8)\n\n#### **B. MENU ITEMS & PRICES**\n*(Note: Use these prices for calculations, but do not display them in chat unless asked or during the Revision phase).*\n\n**(Include the full menu text provided in the previous prompt here... Keeping it abbreviated for this system message update to save space, but ensure the full menu is present in your actual prompt)**\n[... INSERT FULL MENU HERE ...]\n\n#### **C. Common Questions (FAQ)**\n- **Sizes:** Roll (1 person), Medium (1 person), Large (2-3 people), Family (4 people).\n- **Cutting:** We cut all feteer by default.\n- **Menu Link:** https://tawriqa.com/menu-ar\n\n### 6. INTENT CLASSIFICATION & OUTPUT RULES\nClassify user input into exactly **ONE** intent.\n\n1.  **`PROVIDE_NAME`**\n    - Trigger: User provides name. Action: Welcome and ask \"What would you like to order?\" (Do not ask location yet).\n    - Output Data: `customer_name`.\n\n2.  **`CHECK_COVERAGE`**\n    - Trigger: User sends Maps link/Pin.\n    - Condition: Only trigger in Phase 3 (Location Phase).\n    - Output Data: `maps_link` OR `lat` and `lng`.\n\n3.  **`CONFIRM_ORDER`**\n    - Trigger: User says \"Yes\" AFTER Revision Phase.\n    - Data: `items` (Array), `address_id` (Integer from context ID), `kitchen_notes`.\n\n4.  **`MODIFY_ORDER`**\n    - Trigger: User confirms changes to an active order.\n    - Data: `order_id`, `new_items`, `notes`.\n\n5.  **`CANCEL_ORDER`**\n    - Trigger: \"Cancel order\".\n    - Data: `order_id`, `reason`.\n\n6.  **`GENERAL_QUERY`**\n    - Trigger: Greetings, Menu browsing, Building order, Address selection (before checking coverage), Revision summary.\n    - Data: `{}`.\n\n### 7. JSON OUTPUT SCHEMA (STRICT)\n```json\n{\n  \"intent\": \"INTENT_NAME\",\n  \"reply_to_user\": \"Response string (Egyptian Arabic/English) ending with a question.\",\n  \"data\": {\n    // Only include fields relevant to the intent.\n  }\n}\n```\n\n### 8. EXTENSIVE EXAMPLES (UPDATED)\n\n**Ex 1: Greeting & Name (Phase 1)**\n*User:* \"Salam Alaykom\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…! Ù…Ù†ÙˆØ± ØªÙˆØ±ÙŠÙ‚Ù‡ â¤ï¸ Ù…Ù…ÙƒÙ† Ø£ØªØ´Ø±Ù Ø¨Ø§Ø³Ù… Ø­Ø¶Ø±ØªÙƒØŸ\",\n  \"data\": {}\n}\n```\n\n**Ex 2: Negotiation - No Prices shown (Phase 2)**\n*User:* \"Menu please\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"Ø¹Ù†Ø¯Ù†Ø§ ÙØ·ÙŠØ± Ù…Ø´Ù„ØªØªØŒ ÙˆÙØ·Ø§ÙŠØ± Ø­Ø§Ø¯Ù‚ (Ù„Ø­ÙˆÙ…ØŒ ÙØ±Ø§Ø®ØŒ Ø³ÙŠ ÙÙˆØ¯ØŒ Ø¬Ø¨Ù†) ÙˆÙØ·Ø§ÙŠØ± Ø­Ù„ÙˆØŒ ÙˆØ¨ÙˆÙƒØ³Ø§Øª Ø§Ù„ØªÙˆÙÙŠØ±. ğŸ¥ ØªØ­Ø¨ ØªØ·Ù„Ø¨ Ø­Ø§Ø¬Ø© Ù…Ø¹ÙŠÙ†Ø© ÙˆÙ„Ø§ Ø§Ø¨Ø¹ØªÙ„Ùƒ Ø§Ù„Ù…Ù†ÙŠÙˆ ÙƒØ§Ù…Ù„ØŸ\",\n  \"data\": {}\n}\n```\n\n**Ex 3: Building Order - Asking Price (Phase 2)**\n*User:* \"Ø¨ÙƒØ§Ù… Ø§Ù„ÙØ·ÙŠØ± Ø§Ù„Ù…Ø´Ù„ØªØªØŸ\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"Ø§Ù„Ù…Ø´Ù„ØªØª Ø¹Ù†Ø¯Ù†Ø§ Ø£Ø­Ø¬Ø§Ù… ÙŠØ§ ÙÙ†Ø¯Ù…:\\nÙˆØ³Ø· + 3 ØºÙ…ÙˆØ³ Ø¨Ù€ 135 Ø¬\\nÙƒØ¨ÙŠØ±Ø© + 4 ØºÙ…ÙˆØ³ Ø¨Ù€ 250 Ø¬\\nØ¹Ø§Ø¦Ù„ÙŠ + 5 ØºÙ…ÙˆØ³ Ø¨Ù€ 350 Ø¬\\nØªØ­Ø¨ Ø£Ø¶ÙŠÙÙ„Ùƒ ÙˆØ§Ø­Ø¯Ø©ØŸ ğŸ˜‰\",\n  \"data\": {}\n}\n```\n\n**Ex 4: Building Order - Not Asking Price (Phase 2)**\n*User:* \"Ø¹Ø§ÙŠØ² ÙˆØ§Ø­Ø¯Ø© Ù…Ø´Ù„ØªØª ÙˆØ³Ø·\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ÙŠØ§ Ø¹ÙŠÙ†ÙŠ Ø¹Ø§Ù„Ø£Ø®ØªÙŠØ§Ø±! ğŸ˜ Ø¶ÙØªÙ„Ùƒ 1 Ù…Ø´Ù„ØªØª ÙˆØ³Ø·. ØªØ­Ø¨ ØªØ®ØªØ§Ø± Ø§Ù„ØºÙ…ÙˆØ³ Ø¥ÙŠÙ‡ØŸ (Ø¹Ø³Ù„ØŒ Ø¬Ø¨Ù†Ø© Ù‚Ø¯ÙŠÙ…Ø©ØŒ Ù‚Ø´Ø·Ø©..)\",\n  \"data\": {}\n}\n```\n*(Note: Price is NOT shown here).*\n\n**Ex 5: Triggering Location (Phase 3)**\n*User:* \"ØªÙ…Ø§Ù… ÙƒØ¯Ù‡\" (Done)\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… ÙŠØ§ Ø¨Ø§Ø´Ø§! ğŸ›µ ØªØ­Ø¨ Ù†ÙˆØµÙ„Ùƒ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠÙ†ØŸ Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø¹Ù†ÙˆØ§Ù† Ù…ØªØ³Ø¬Ù„ Ø§Ø®ØªØ§Ø±Ù‡ØŒ Ø£Ùˆ Ø§Ø¨Ø¹ØªÙ„ÙŠ Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù†.\",\n  \"data\": {}\n}\n```\n\n**Ex 6: Revision & Bill (Phase 4)**\n*Context:* Address ID 101 selected.\n*User:* \"Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØª\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù…ØŒ Ù‡Ø§Ù†Ø¨Ø¹Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØª (Ø´Ø§Ø±Ø¹ Ø¬ÙŠÙ‡Ø§Ù†). ğŸ“\\n\\nÙ…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨:\\n- 1 ÙØ·ÙŠØ±Ø© Ù…Ø´Ù„ØªØª ÙˆØ³Ø· (135 Ø¬)\\n\\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 135 Ø¬Ù†ÙŠÙ‡ + Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØªÙˆØµÙŠÙ„.\\nØ§Ù„Ø£ÙˆØ±Ø¯Ø± ÙƒØ¯Ù‡ Ù…Ø¸Ø¨ÙˆØ·ØŸ\",\n  \"data\": {}\n}\n```\n*(Note: NOW the price is shown).*\n\n**Ex 7: Confirmation (Phase 5)**\n*User:* \"Ø£ÙŠÙˆØ© ØªÙ…Ø§Ù…\"\n*Assistant:*\n```json\n{\n  \"intent\": \"CONFIRM_ORDER\",\n  \"reply_to_user\": \"ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨! ğŸ‰ Ø£Ù„Ù Ù‡Ù†Ø§ Ù…Ù‚Ø¯Ù…Ø§Ù‹.\",\n  \"data\": {\n    \"items\": [ { \"name\": \"Meshaltet Medium\", \"qty\": 1, \"price\": 135 } ],\n    \"address_id\": 101,\n    \"kitchen_notes\": \"\"\n  }\n}\n```\n\n# LIVE DYNAMIC INFOS:\n*TIME NOW : {{ DateTime.now().setZone(\"UTC+2\").format('M/dd/yyyy H:mm') }}\n*DYNAMIC CONTEXT FROM DATABASE:\n{{ $json.system_context }}\n"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3,
            "position": [
                7152,
                2512
            ],
            "id": "0f2c9000-dd03-4c55-be83-1fde5b81b2dc",
            "name": "AI Agent3"
        },
        {
            "parameters": {
                "jsCode": "// --- Robust JSON Parser for AI Agent Output ---\n\n// 1. Get the raw string from the previous node (AI Agent)\n// Note: Ensure the previous node is actually outputting to a field named 'output'\n// If your AI Agent outputs to 'text' or 'response', change this line.\nconst rawOutputString = $input.first().json.output;\n\n// 2. Validation: Check if input exists\nif (!rawOutputString || typeof rawOutputString !== 'string') {\n  return [{ \n    json: { \n      error: \"Input field 'output' is missing or not a string. Check AI Agent settings.\",\n      originalInput: $input.first().json \n    } \n  }];\n}\n\nlet jsonString = null;\n\n// --- STRATEGY 1: Regex for Markdown Code Blocks (```json ... ```) ---\n// Captures content between triple backticks, optionally ignoring the word 'json'\nconst markdownRegex = /`{3,}(?:json)?\\s*([\\s\\S]*?)\\s*`{3,}/i;\nconst markdownMatch = rawOutputString.match(markdownRegex);\n\nif (markdownMatch && markdownMatch[1]) {\n  jsonString = markdownMatch[1].trim();\n}\n\n// --- STRATEGY 2: Brute Force (Find first '{' and last '}') ---\n// Useful if the AI chats before/after the JSON without code blocks.\nif (!jsonString) {\n  const startIndex = rawOutputString.indexOf('{');\n  const endIndex = rawOutputString.lastIndexOf('}');\n\n  if (startIndex !== -1 && endIndex !== -1 && endIndex > startIndex) {\n    jsonString = rawOutputString.substring(startIndex, endIndex + 1).trim();\n  }\n}\n\n// 3. If no JSON-like structure found, return error\nif (!jsonString) {\n  return [{ \n    json: { \n      error: \"No JSON object found in the AI response.\",\n      originalOutput: rawOutputString\n    }\n  }];\n}\n\n// 4. Parse the JSON\ntry {\n  // Attempt clean parse\n  const parsedJson = JSON.parse(jsonString);\n  return [{ json: parsedJson }];\n} catch (error) {\n  // 5. Retry Strategy: Fix common AI JSON errors\n  try {\n    // Fix 1: Escape unescaped newlines inside strings (common in addresses/notes)\n    // This regex looks for newlines that are NOT preceded by a valid escape char\n    // Note: This is a simple heuristic; strictly broken JSON is hard to fix perfectly.\n    const fixedJsonString = jsonString.replace(/(?<!\\\\)\\n/g, \"\\\\n\");\n    \n    const parsedJsonRetry = JSON.parse(fixedJsonString);\n    return [{ json: parsedJsonRetry }];\n  } catch (retryError) {\n    // Final Failure\n    return [{ \n      json: {\n        error: \"JSON Parsing Failed\",\n        details: retryError.message,\n        extractedString: jsonString,\n        originalOutput: rawOutputString\n      }\n    }];\n  }\n}"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                7760,
                2464
            ],
            "id": "096158c2-30c3-40f7-8188-965c369835aa",
            "name": "Code in JavaScript7"
        },
        {
            "parameters": {
                "rules": {
                    "values": [
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 3
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{ $json.intent }}",
                                        "rightValue": "PROVIDE_NAME",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        },
                                        "id": "561df129-067d-47b2-a123-3a00b907eb9b"
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "PROVIDE_NAME"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 3
                                },
                                "conditions": [
                                    {
                                        "id": "cb5f3a4a-4d91-44c5-81dc-af9f028b4263",
                                        "leftValue": "={{ $json.intent }}",
                                        "rightValue": "CHECK_COVERAGE",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "CHECK_COVERAGE"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 3
                                },
                                "conditions": [
                                    {
                                        "id": "8ddc6098-7356-4f15-931f-2f03dff6c448",
                                        "leftValue": "={{ $json.intent }}",
                                        "rightValue": "GENERAL_QUERY",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "GENERAL_QUERY"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 3
                                },
                                "conditions": [
                                    {
                                        "id": "0555bc96-272c-4c74-b68c-5aac04f563a9",
                                        "leftValue": "={{ $json.intent }}",
                                        "rightValue": "CONFIRM_ORDER",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "CONFIRM_ORDER"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 3
                                },
                                "conditions": [
                                    {
                                        "id": "cf1df5c5-27cb-4989-b787-25eee175b775",
                                        "leftValue": "={{ $json.intent }}",
                                        "rightValue": "MODIFY_ORDER",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "MODIFY_ORDER"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 3
                                },
                                "conditions": [
                                    {
                                        "id": "a69326c7-9a55-4225-9a4e-db0d5bee7597",
                                        "leftValue": "={{ $json.intent }}",
                                        "rightValue": "CANCEL_ORDER",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals",
                                            "name": "filter.operator.equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "CANCEL_ORDER"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.4,
            "position": [
                8000,
                2400
            ],
            "id": "358f8326-8059-4904-a0a9-21edb2e31b85",
            "name": "Switch3"
        },
        {
            "parameters": {
                "url": "={{ $('Code').item.json.data.maps_link }}",
                "options": {
                    "redirect": {
                        "redirect": {
                            "maxRedirects": 0
                        }
                    },
                    "response": {
                        "response": {
                            "fullResponse": true,
                            "neverError": true
                        }
                    }
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                9712,
                2192
            ],
            "id": "a07829ab-67c7-4310-92b2-2bcf8763f3de",
            "name": "HTTP Request10"
        },
        {
            "parameters": {
                "jsCode": "const results = [];\n\n// Helper function to clean floating point errors\n// Example: \"31.177160999999995\" -> \"31.177161\"\nfunction cleanCoordinate(val) {\n  if (!val) return null;\n  // 1. Parse as float\n  // 2. Fix to 7 decimal places (high precision) to round off the .99999...\n  // 3. Parse again to remove trailing zeros (e.g. \"34.50000\" becomes 34.5)\n  // 4. Return as string\n  return parseFloat(parseFloat(val).toFixed(7)).toString();\n}\n\nfor (const item of items) {\n  const html = item.json.data || \"\";\n  const locationHeader = item.json.headers && item.json.headers.location ? item.json.headers.location : \"\";\n\n  let lat = null;\n  let long = null;\n  let method = null;\n\n  // ---------------------------------------------------------\n  // PRIORITY 1: 'q' Parameter with EXPLICIT NUMBERS\n  // ---------------------------------------------------------\n  // Matches: q=31.177,34.781 (and handles HTML entities like &amp; before it)\n  // ---------------------------------------------------------\n  const qParamRegex = /q=(-?\\d+\\.\\d+)(?:%2C|\\+|%20|%2B|,\\s*|,\\+|&|,|;| )+(-?\\d+\\.\\d+)/i;\n  const qMatch = html.match(qParamRegex);\n\n  if (qMatch) {\n    lat = qMatch[1];\n    long = qMatch[2];\n    method = \"priority_1_url_q_param\";\n  }\n\n  // ---------------------------------------------------------\n  // PRIORITY 2: Javascript State (For Hotels/Places)\n  // ---------------------------------------------------------\n  // Used if 'q' is text.\n  // Note: In this JS array, Longitude (index 1) is BEFORE Latitude (index 2)\n  // ---------------------------------------------------------\n  if (!lat) {\n    const stateRegex = /window\\.APP_INITIALIZATION_STATE=\\s*\\[\\[\\[[^,]+,(-?\\d+\\.\\d+),(-?\\d+\\.\\d+)\\]/;\n    const stateMatch = html.match(stateRegex);\n\n    if (stateMatch) {\n      long = stateMatch[1];\n      lat = stateMatch[2];\n      method = \"priority_2_app_state\";\n    }\n  }\n\n  // ---------------------------------------------------------\n  // PRIORITY 3: Static Map (Strict 'Markers' Only)\n  // ---------------------------------------------------------\n  if (!lat) {\n    const staticMapRegex = /staticmap\\?.*?(?:markers)=(-?\\d+\\.\\d+)(?:%2C|,|\\+|%20)+(-?\\d+\\.\\d+)/i;\n    const metaMatch = html.match(staticMapRegex);\n\n    if (metaMatch) {\n      lat = metaMatch[1];\n      long = metaMatch[2];\n      method = \"priority_3_static_map_marker\";\n    }\n  }\n\n  // ---------------------------------------------------------\n  // PRIORITY 4: Redirect Headers\n  // ---------------------------------------------------------\n  if (!lat && locationHeader) {\n    let targetUrl = locationHeader;\n    if (targetUrl.includes(\"continue=\")) {\n      try {\n        const params = new URLSearchParams(targetUrl.split('?')[1]);\n        targetUrl = params.get('continue') || targetUrl;\n      } catch (e) {}\n    }\n\n    const headerRegex = /@(-?\\d+\\.\\d+),(-?\\d+\\.\\d+)/;\n    const headerMatch = targetUrl.match(headerRegex);\n\n    if (headerMatch) {\n      lat = headerMatch[1];\n      long = headerMatch[2];\n      method = \"priority_4_header\";\n    }\n  }\n\n  // ---------------------------------------------------------\n  // FINAL STEP: Clean and Format Numbers\n  // ---------------------------------------------------------\n  results.push({\n    json: {\n      latitude: cleanCoordinate(lat),\n      longitude: cleanCoordinate(long)\n    }\n  });\n}\n\nreturn results;"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                9936,
                2192
            ],
            "id": "b176de83-fd8a-4f85-887b-d0008291ccc5",
            "name": "Code in JavaScript8"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 3
                    },
                    "conditions": [
                        {
                            "id": "84b29200-3dca-4f4b-98f6-7fb298263b7e",
                            "leftValue": "={{ $('Check Coverage1').item.json.covered }}",
                            "rightValue": false,
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
                10304,
                2208
            ],
            "id": "6b8e6659-8bd8-43cb-8f64-bc63f089fe95",
            "name": "If2"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://tarwekaapi.ai4eg.com/api/check-coverage",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "my_super_secret_n8n_password"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "lat",
                            "value": "={{ $json.latitude }}"
                        },
                        {
                            "name": "lng",
                            "value": "={{ $json.longitude }}"
                        }
                    ]
                },
                "options": {
                    "redirect": {
                        "redirect": {}
                    }
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                10128,
                2208
            ],
            "id": "f4e70f8b-b365-48fe-90c9-a5c7745196e1",
            "name": "Check Coverage1"
        },
        {
            "parameters": {
                "operation": "getAll",
                "tableId": "customer_addresses",
                "returnAll": true,
                "filters": {
                    "conditions": [
                        {
                            "keyName": "customer_id",
                            "condition": "eq",
                            "keyValue": "={{ $('Switch').item.json.id }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                5936,
                2288
            ],
            "id": "1ad371c3-44e9-4b57-86c0-20433388f112",
            "name": "Get many rows",
            "alwaysOutputData": true,
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "jsCode": "// 1. Get User Message\nconst userMessage = $('Code6').first().json.body;\n\n// 2. Get Data from SQL\nconst rawSql = $('Execute a SQL query').first().json;\nconst data = rawSql.result || rawSql.get_customer_context || rawSql;\n\n// 3. Build The Dynamic System Context\nlet contextText = \"\";\n\nif (!data || data.found === false) {\n  contextText = \"CURRENT USER CONTEXT:\\n- Status: NEW CUSTOMER\\n- Instruction: Welcome them warmly and ask for their Name.\";\n} else {\n  // Existing User\n  contextText = `CURRENT USER CONTEXT:\\n`;\n  contextText += `- Name: ${data.customer.full_name}\\n`;\n  contextText += `- Customer DB ID: ${data.customer.id}\\n`;\n\n  // A. Active Order Check\n  if (data.active_order) {\n    contextText += `\\nâš ï¸ ACTIVE ORDER FOUND:\\n`;\n    contextText += `- Order ID: #${data.active_order.id}\\n`;\n    contextText += `- Status: ${data.active_order.status}\\n`;\n    contextText += `- Delivery Fee: ${data.active_order.delivery_fee} EGP\\n`;\n    contextText += `- Total Price: ${data.active_order.total_price} EGP\\n`; // <-- THE FIX\n    contextText += `- Items: ${JSON.stringify(data.active_order.items)}\\n`;\n    contextText += `- Modification Pending?: ${data.active_order.modification_pending}\\n`;\n    contextText += `INSTRUCTION: Use this order for tracking/modification.\\n`;\n  } else {\n    contextText += `- Active Orders: None.\\n`;\n  }\n\n  // B. Address List\n  if (data.addresses && Array.isArray(data.addresses) && data.addresses.length > 0) {\n    contextText += `\\nSAVED ADDRESSES (User can choose by number):\\n`;\n    data.addresses.forEach((addr, index) => {\n      contextText += `  ${index + 1}. ${addr.address_text} (ID: ${addr.id})\\n`;\n    });\n    contextText += `INSTRUCTION: If user selects an address, use the ID provided.\\n`;\n  } else {\n    contextText += `\\nSAVED ADDRESSES: None. (Ask for Location Pin or Link).\\n`;\n  }\n}\n\n// 4. Output Separated Fields\nreturn [{\n  json: {\n    user_message: userMessage,\n    system_context: contextText,\n    customer_id: (data && data.found) ? data.customer.id : null,\n    active_order_id: (data && data.active_order) ? data.active_order.id : null\n  }\n}];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                6768,
                2464
            ],
            "id": "d9215b86-7887-4a2c-838c-774c666df8ed",
            "name": "Code in JavaScript9"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 3
                    },
                    "conditions": [
                        {
                            "id": "4f5f8aab-9e90-40dd-a166-a8b60c8299e7",
                            "leftValue": "={{ $('Code').item.json.data.maps_link }}",
                            "rightValue": "",
                            "operator": {
                                "type": "string",
                                "operation": "exists",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
                8896,
                2176
            ],
            "id": "24bf6670-a011-42fb-8e39-d48624f80468",
            "name": "If4"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://tarwekaapi.ai4eg.com/api/check-coverage",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "my_super_secret_n8n_password"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "lat",
                            "value": "={{ $('Code').item.json.data.lat }}"
                        },
                        {
                            "name": "lng",
                            "value": "={{ $('Code').item.json.data.lng }}"
                        }
                    ]
                },
                "options": {
                    "redirect": {
                        "redirect": {}
                    }
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                9728,
                2032
            ],
            "id": "bd3c6b63-ab3b-4169-b7f0-c42eb1d41c95",
            "name": "Check Coverage3"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 3
                    },
                    "conditions": [
                        {
                            "id": "8e5a1572-c7ed-468e-85a4-972555168ce2",
                            "leftValue": "={{ $json.covered }}",
                            "rightValue": true,
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
                9968,
                2000
            ],
            "id": "17dc1111-27b2-4ca1-bf8c-597e7b9fc316",
            "name": "If7"
        },
        {
            "parameters": {
                "operation": "update",
                "tableId": "customers",
                "filters": {
                    "conditions": [
                        {
                            "keyName": "id",
                            "condition": "eq",
                            "keyValue": "={{ $('Switch').first().json.id }}"
                        }
                    ]
                },
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "full_name",
                            "fieldValue": "={{ $json.data.customer_name }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                8592,
                1872
            ],
            "id": "3ffe8904-8043-48ee-a285-094aee7c5ae0",
            "name": "Update a row",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').item.json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').item.json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').item.json.SenderJid }}\",\n    \"text\": \"{{ JSON.stringify($json.reply_to_user).slice(1, -1) }}\",\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                8688,
                2176
            ],
            "id": "a4b28395-5a1a-4679-af82-d29179834866",
            "name": "send txt3"
        },
        {
            "parameters": {
                "tableId": "customer_addresses",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "customer_id",
                            "fieldValue": "={{ $('Switch').item.json.result.customer.id }}"
                        },
                        {
                            "fieldId": "latitude",
                            "fieldValue": "={{ $('Code in JavaScript8').item.json.latitude }}"
                        },
                        {
                            "fieldId": "longitude",
                            "fieldValue": "={{ $('Code in JavaScript8').item.json.longitude }}"
                        },
                        {
                            "fieldId": "address_text",
                            "fieldValue": "={{ $json.display_name }}"
                        },
                        {
                            "fieldId": "label",
                            "fieldValue": "=https://www.google.com/maps/place/{{ $('Code in JavaScript8').item.json.latitude }},{{ $('Code in JavaScript8').item.json.longitude }}"
                        },
                        {
                            "fieldId": "is_default",
                            "fieldValue": "true"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                10912,
                2112
            ],
            "id": "d31e9967-2496-4a1c-bfd0-8c2e2a326a6e",
            "name": "Create a row4",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "url": "=https://geocode.maps.co/reverse?lat={{ $('Code in JavaScript8').item.json.latitude }}&lon={{ $('Code in JavaScript8').item.json.longitude }}&api_key=692791e53d275820577939xlc48e891",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                10688,
                2112
            ],
            "id": "107d380d-84df-4f9b-97ea-b424059d7d4e",
            "name": "TO ADDRESS2"
        },
        {
            "parameters": {
                "tableId": "customer_addresses",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "customer_id",
                            "fieldValue": "={{ $('Switch').item.json.id }}"
                        },
                        {
                            "fieldId": "latitude",
                            "fieldValue": "={{ $('Code').item.json.data.lat }}"
                        },
                        {
                            "fieldId": "longitude",
                            "fieldValue": "={{ $('Code').item.json.data.lng }}"
                        },
                        {
                            "fieldId": "address_text",
                            "fieldValue": "={{ $json.display_name }}"
                        },
                        {
                            "fieldId": "label",
                            "fieldValue": "=https://www.google.com/maps/place/{{ $('Code').item.json.data.lat }},{{ $('Code').item.json.data.lng }}"
                        },
                        {
                            "fieldId": "is_default",
                            "fieldValue": "true"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                10864,
                1792
            ],
            "id": "2681bb2b-ade5-469b-9a7f-7a66b2a3071a",
            "name": "Create a row8",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "url": "=https://geocode.maps.co/reverse?lat={{ $('Code in JavaScript7').item.json.data.lat }}&lon={{ $('Code in JavaScript7').item.json.data.lng }}&api_key=692791e53d275820577939xlc48e891",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                10560,
                1792
            ],
            "id": "1bd36e34-0223-4e38-b6ac-8360043b0118",
            "name": "TO ADDRESS4"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message = $input.first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                8464,
                2176
            ],
            "id": "30fb0ca8-07b7-4c83-982a-2124e548027e",
            "name": "Code"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').first().json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').first().json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').first().json.SenderJid }}\",\n    \"text\": \"{{ JSON.stringify($json.reply_to_user).slice(1, -1) }}\",\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                8960,
                2304
            ],
            "id": "ee4204e6-dbad-49c1-8bf1-42750e8b4b01",
            "name": "send txt7"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message = $input.first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                8608,
                2304
            ],
            "id": "94a3ef28-88fc-4a86-9eb5-3a628b66a8fa",
            "name": "Code5"
        },
        {
            "parameters": {
                "sessionIdType": "customKey",
                "sessionKey": "={{ $('Edit Fields').first().json.SenderJid }}",
                "tableName": "tarweka4",
                "contextWindowLength": 100
            },
            "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
            "typeVersion": 1.3,
            "position": [
                10080,
                3472
            ],
            "id": "7328cd21-14e3-4ee6-8c6f-d15721098c75",
            "name": "Postgres Chat Memory",
            "credentials": {
                "postgres": {
                    "id": "7t4sL9T7mUlwFi06",
                    "name": "Postgres account 3"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://tarwekaapi.ai4eg.com/api/check-coverage",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "my_super_secret_n8n_password"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "lat",
                            "value": "={{ $('Webhook').item.json.body.data.message.locationMessage.degreesLatitude }}"
                        },
                        {
                            "name": "lng",
                            "value": "={{ $('Webhook').item.json.body.data.message.locationMessage.degreesLongitude }}"
                        }
                    ]
                },
                "options": {
                    "redirect": {
                        "redirect": {}
                    }
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                2336,
                2848
            ],
            "id": "3467a254-428c-4030-aa08-8f203e85c943",
            "name": "Check Coverage4"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 3
                    },
                    "conditions": [
                        {
                            "id": "8e5a1572-c7ed-468e-85a4-972555168ce2",
                            "leftValue": "={{ $json.covered }}",
                            "rightValue": false,
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
                2640,
                2912
            ],
            "id": "2a48cc52-2cb1-436f-9e08-990b47b10559",
            "name": "If8"
        },
        {
            "parameters": {
                "url": "=https://geocode.maps.co/reverse?lat={{ $('Webhook').item.json.body.data.message.locationMessage.degreesLatitude }}&lon={{ $('Webhook').item.json.body.data.message.locationMessage.degreesLongitude }}&api_key=692791e53d275820577939xlc48e891",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                2960,
                2896
            ],
            "id": "5a040fc6-7317-4ef8-baa5-bcb88e06b90e",
            "name": "TO ADDRESS5"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').item.json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').item.json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').item.json.SenderJid }}\",\n    \"text\": \"{{ $('Code in JavaScript7').item.json.reply_to_user }}\",\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                8976,
                1840
            ],
            "id": "d0073431-05a4-411b-bdb1-b6ef8494f599",
            "name": "send txt15"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message =  $('Code in JavaScript7').first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                8800,
                1856
            ],
            "id": "e9a5890a-1d0e-4af6-8351-9853b66d08fe",
            "name": "Code11"
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "=HISTORY: User sent a location for checking coverage.\nSYSTEM RESULT: \n- Is Covered: {{ $('Check Coverage1').item.json.covered }}\n- Delivery Fee: {{ $('Check Coverage1').item.json.delivery_fee }}\n- Address Found: {{ $if(\n    $('TO ADDRESS2').isExecuted,\n    $('TO ADDRESS2').item.json.display_name,\n    $('TO ADDRESS3').item.json.display_name\n) }}\n\nINSTRUCTION:\n1. If \"Is Covered\" is TRUE: Tell the user good news, mention the address and fee, and ask what they want to order. (Intent: GENERAL_QUERY or ADD_TO_CART context).\n2. If \"Is Covered\" is FALSE: Apologize politely, state that we don't deliver to [Address Found], and ask if they have another location or want to visit a branch. (Intent: GENERAL_QUERY).\n\nDO NOT output intent \"CHECK_COVERAGE\" again. The check is already done.",
                "options": {
                    "systemMessage": "=\n### 1. IDENTITY & PERSONA\nYou are 'TarwekaBot', the intelligent and friendly waiter for **Tarweka Restaurant (ØªØ±ÙˆÙŠÙ‚Ø©)**.\nYour goal is to collect orders, check delivery coverage, and answer questions using our specific knowledge base.\n\n**Tone:** \n- Professional but warm (Egyptian Hospitality / Ø§Ø¨Ù† Ø¨Ù„Ø¯).\n- Languages: **Egyptian Arabic** (Franco or Script) and **English**.\n- Always reply in the same language the user speaks.\n- **Emoji Usage:** Use emojis freely (ğŸ¥, ğŸ¯, ğŸ›µ, â¤ï¸, ğŸ“).\n\n### 2. THE PRIME DIRECTIVE (CRITICAL)\n1. **JSON ONLY:** You must **NEVER** output conversational text outside of a JSON object.\n2. **NO MARKDOWN:** Do not use code blocks (```json). Output raw JSON only.\n3. **ALWAYS ASK:** Your `reply_to_user` must **ALWAYS** end with a question or call-to-action (unless the order is finalized).\n\n### 3. THE ONBOARDING FLOW (STRICT SEQUENCE)\n1.  **Phase 1: Identity** -> If Name unknown, ask for it.\n2.  **Phase 2: Location** -> If Location unknown, ask for **Location Pin** or **Google Maps Link**.\n3.  **Phase 3: Ordering** -> Only after coverage is confirmed (by the system), take the order.\n\n### 4. KNOWLEDGE BASE & MENU (FACTS ONLY)\n\n#### **A. Branches & Contact**\n- **Phone:** 0248832036 (Unified Number).\n- **Mansoura Branch:** 1st Tor3a St, opposite Mansoura Univ, near Gehan St intersection.\n  - Link: https://maps.app.goo.gl/pf4DMxppTh3y1YuG7\n- **Almaza (Cairo) Branch:** Almaza Park Mall, opposite EgyptAir Hospital, next to Second Cup.\n  - Link: https://maps.app.goo.gl/KnP6pzFdczjHPZxs8\n\n#### **B. Savory Feteer Sizes (Portions)**\n- **Roll (26cm length):** For 1 Person.\n- **Medium (26cm dia):** For 1 Person.\n- **Large (30cm dia):** 2 people (hungry) OR 2-3 people (light eaters).\n- **Family (37cm dia):** 4 people (2 adults + 2 kids).\n\n#### **C. Sweet Feteer (Dessert)**\n- **Sizes:** Rectangular (18x30cm). The Roll version is approx 9x15cm.\n- **Heavy Options:** (Dates/Ibreem, Nutella, Lotus, Kinder) -> These are very filling, suitable for sharing (2-3 people).\n- **Light Options:** Sugar & Milk, Custard.\n\n#### **D. Meshaltet (Traditional)**\n- **Tawriqa Plate:** (3 pcs + 2 dips) -> 1 Person.\n- **Medium:** (+3 dips) -> 1 Hungry Person OR 2 Sharing.\n- **Large:** (+4 dips) -> 2-3 People.\n- **Family:** (+5 dips) -> Family of 4.\n\n#### **E. Common Questions (FAQ)**\n- **Cutting:** We cut all feteer by default. Users can request \"No Cut\" or \"Cut in half\" (for Rolls).\n- **Sauce:** Some are inside, some on top (Ranch/BBQ).\n- **Sausage (Sogo2):** Spices are balanced (not spicy). If user wants Spicy, they must add a note/request it.\n- **Menu Link:** https://tawriqa.com/menu-ar\n\n### 5. INTENT CLASSIFICATION & OUTPUT RULES\nClassify user input into exactly **ONE** intent.\n**CRITICAL:** Only include the `data` fields listed for that specific intent. Do **NOT** output fields with null values.\n\n1.  **`PROVIDE_NAME`**\n    - Trigger: User gives name. Action: Ask for Location.\n    - **Output Data:** `customer_name`.\n\n2.  **`CHECK_COVERAGE`**\n    - Trigger: User sends Google Maps link OR Location Pin.\n    - **Output Data:** `maps_link` (if link) OR `lat` and `lng` (if digits).\n\n3.  **`ADD_TO_CART`**\n    - Trigger: User selects items.\n    - **Logic:** Match items to Menu. Keep cumulative list.\n    - **Output Data:** `items` (Array of {name, qty, price}).\n\n4.  **`CONFIRM_ORDER`**\n    - Trigger: \"Confirm\", \"Place order\", \"ØªÙ…Ø§Ù…\".\n    - **Logic:** Only trigger if items exist in cart history.\n    - **Output Data:** `items`, `customer_name` (if known), `lat` (if known), `lng` (if known).\n\n5.  **`TRACK_ORDER`**\n    - Trigger: \"Status of order #15\".\n    - **Output Data:** `order_id`.\n\n6.  **`MODIFY_ORDER`**\n    - Trigger: \"Change order #50\", \"Add cola to order 10\".\n    - **Output Data:** `order_id`, `new_items`, `notes`.\n\n7.  **`CANCEL_ORDER`**\n    - Trigger: \"Cancel order\".\n    - **Output Data:** `order_id`, `reason`.\n\n8.  **`GENERAL_QUERY`**\n    - Trigger: FAQs (Sizes, Location, Menu), Greetings.\n    - **Output Data:** (Empty Object) `{}`.\n\n### 6. JSON OUTPUT SCHEMA\nYour output must look exactly like this structure, but only including relevant data fields:\n\n```json\n{\n  \"intent\": \"INTENT_NAME\",\n  \"reply_to_user\": \"Response string (Egyptian Arabic/English)\",\n  \"data\": {\n    // Only include fields relevant to the intent. Examples:\n    // \"lat\": 30.0, \"lng\": 31.0\n    // \"items\": [...]\n  }\n}\n```\n\n### 7. EXAMPLES (CONTEXT & CASES)\n\n**Ex 1: Greeting (Unknown Name)**\n*User:* \"Salam Alaykom\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…! Ù…Ù†ÙˆØ± ØªØ±ÙˆÙŠÙ‚Ø© â¤ï¸ Ù…Ù…ÙƒÙ† Ø£ØªØ´Ø±Ù Ø¨Ø§Ø³Ù… Ø­Ø¶Ø±ØªÙƒØŸ\",\n  \"data\": {}\n}\n```\n\n**Ex 2: Name Provided**\n*User:* \"Ahmed Mohamed\"\n*Assistant:*\n```json\n{\n  \"intent\": \"PROVIDE_NAME\",\n  \"reply_to_user\": \"Ø£Ù‡Ù„Ù‹Ø§ ÙŠØ§ Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯! ğŸ” Ø¹Ø´Ø§Ù† Ù†Ø´ÙˆÙ ÙØ±ÙˆØ¹Ù†Ø§ Ø¨ØªÙˆØµÙ„ÙƒØŒ Ù…Ù…ÙƒÙ† ØªØ¨Ø¹Øª Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù† (Location Pin) Ø£Ùˆ Ù„ÙŠÙ†Ùƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŸ\",\n  \"data\": { \"customer_name\": \"Ahmed Mohamed\" }\n}\n```\n\n**Ex 3: Coverage Check (Link)**\n*User:* \"https://maps.google.com/...\"\n*Assistant:*\n```json\n{\n  \"intent\": \"CHECK_COVERAGE\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØºØ·ÙŠØ©... â±ï¸ Ø«ÙˆØ§Ù†ÙŠ ÙˆÙ‡Ø±Ø¯ Ø¹Ù„ÙŠÙƒ.\",\n  \"data\": { \"maps_link\": \"https://maps.google.com/...\" }\n}\n```\n\n**Ex 4: Coverage Check (Pin)**\n*User:* \"Location: 30.044, 31.235\"\n*Assistant:*\n```json\n{\n  \"intent\": \"CHECK_COVERAGE\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†... ğŸ›µ\",\n  \"data\": { \"lat\": 30.044, \"lng\": 31.235 }\n}\n```\n\n**Ex 5: FAQ (Sizes)**\n*User:* \"Ø§Ù„Ø±ÙˆÙ„ Ø¨ÙŠÙƒÙÙŠ ÙƒØ§Ù… ÙˆØ§Ø­Ø¯ØŸ\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ÙØ·ÙŠØ±Ø© Ø§Ù„Ø±ÙˆÙ„ (26 Ø³Ù…) Ø¨ØªÙƒÙÙŠ ÙØ±Ø¯ ÙˆØ§Ø­Ø¯. ğŸŒ¯ ØªØ­Ø¨ ØªØ¬Ø±Ø¨ ÙˆØ§Ø­Ø¯Ø©ØŸ\",\n  \"data\": {}\n}\n```\n\n**Ex 6: Ordering (Complex)**\n*User:* \"Ø¹Ø§ÙŠØ² 2 ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ ÙˆØ³Ø· ÙˆÙˆØ§Ø­Ø¯Ø© Ù†ÙˆØªÙŠÙ„Ø§\"\n*Assistant:*\n```json\n{\n  \"intent\": \"ADD_TO_CART\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… ÙŠØ§ ÙÙ†Ø¯Ù…! ğŸ¥ Ø¶ÙŠÙØªÙ„Ùƒ 2 ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ (ÙˆØ³Ø·) Ùˆ 1 Ù†ÙˆØªÙŠÙ„Ø§. ØªØ­Ø¨ ØªØ²ÙˆØ¯ Ø£ÙŠ Ù…Ø´Ø±ÙˆØ¨Ø§ØªØŸ\",\n  \"data\": {\n    \"items\": [ \n      { \"name\": \"Sausage Feteer Medium\", \"qty\": 2, \"price\": 0 }, \n      { \"name\": \"Nutella Feteer\", \"qty\": 1, \"price\": 0 }\n    ] \n  }\n}\n```\n\n**Ex 7: Modification**\n*User:* \"Ù…Ø¹Ù„Ø´ ÙÙŠ Ø£ÙˆØ±Ø¯Ø± Ø±Ù‚Ù… 50ØŒ Ø´ÙŠÙ„ Ø§Ù„Ù†ÙˆØªÙŠÙ„Ø§ ÙˆØ­Ø· Ù„ÙˆØªØ³\"\n*Assistant:*\n```json\n{\n  \"intent\": \"MODIFY_ORDER\",\n  \"reply_to_user\": \"ÙˆÙ„Ø§ ÙŠÙ‡Ù…Ùƒ! Ù‡Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ø¨Ø® Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙˆØ±Ù‹Ø§ (Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù†ÙˆØªÙŠÙ„Ø§ ÙˆØ¥Ø¶Ø§ÙØ© Ù„ÙˆØªØ³). Ø«ÙˆØ§Ù†ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯...\",\n  \"data\": {\n    \"order_id\": 50,\n    \"new_items\": [\n       { \"name\": \"Sausage Feteer Medium\", \"qty\": 2, \"price\": 0 },\n       { \"name\": \"Lotus Feteer\", \"qty\": 1, \"price\": 0 }\n    ],\n    \"notes\": \"Replace Nutella with Lotus\"\n  }\n}\n```\n```"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3,
            "position": [
                11520,
                2416
            ],
            "id": "99ad7c01-cc52-4333-99f4-51a01f8784c2",
            "name": "AI Agent4"
        },
        {
            "parameters": {
                "jsCode": "// --- Robust JSON Parser for AI Agent Output ---\n\n// 1. Get the raw string from the previous node (AI Agent)\n// Note: Ensure the previous node is actually outputting to a field named 'output'\n// If your AI Agent outputs to 'text' or 'response', change this line.\nconst rawOutputString = $input.first().json.output;\n\n// 2. Validation: Check if input exists\nif (!rawOutputString || typeof rawOutputString !== 'string') {\n  return [{ \n    json: { \n      error: \"Input field 'output' is missing or not a string. Check AI Agent settings.\",\n      originalInput: $input.first().json \n    } \n  }];\n}\n\nlet jsonString = null;\n\n// --- STRATEGY 1: Regex for Markdown Code Blocks (```json ... ```) ---\n// Captures content between triple backticks, optionally ignoring the word 'json'\nconst markdownRegex = /`{3,}(?:json)?\\s*([\\s\\S]*?)\\s*`{3,}/i;\nconst markdownMatch = rawOutputString.match(markdownRegex);\n\nif (markdownMatch && markdownMatch[1]) {\n  jsonString = markdownMatch[1].trim();\n}\n\n// --- STRATEGY 2: Brute Force (Find first '{' and last '}') ---\n// Useful if the AI chats before/after the JSON without code blocks.\nif (!jsonString) {\n  const startIndex = rawOutputString.indexOf('{');\n  const endIndex = rawOutputString.lastIndexOf('}');\n\n  if (startIndex !== -1 && endIndex !== -1 && endIndex > startIndex) {\n    jsonString = rawOutputString.substring(startIndex, endIndex + 1).trim();\n  }\n}\n\n// 3. If no JSON-like structure found, return error\nif (!jsonString) {\n  return [{ \n    json: { \n      error: \"No JSON object found in the AI response.\",\n      originalOutput: rawOutputString\n    }\n  }];\n}\n\n// 4. Parse the JSON\ntry {\n  // Attempt clean parse\n  const parsedJson = JSON.parse(jsonString);\n  return [{ json: parsedJson }];\n} catch (error) {\n  // 5. Retry Strategy: Fix common AI JSON errors\n  try {\n    // Fix 1: Escape unescaped newlines inside strings (common in addresses/notes)\n    // This regex looks for newlines that are NOT preceded by a valid escape char\n    // Note: This is a simple heuristic; strictly broken JSON is hard to fix perfectly.\n    const fixedJsonString = jsonString.replace(/(?<!\\\\)\\n/g, \"\\\\n\");\n    \n    const parsedJsonRetry = JSON.parse(fixedJsonString);\n    return [{ json: parsedJsonRetry }];\n  } catch (retryError) {\n    // Final Failure\n    return [{ \n      json: {\n        error: \"JSON Parsing Failed\",\n        details: retryError.message,\n        extractedString: jsonString,\n        originalOutput: rawOutputString\n      }\n    }];\n  }\n}"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                12224,
                1984
            ],
            "id": "c1e684b1-ad47-41dd-9bc9-45e3804ed91e",
            "name": "Code in JavaScript10"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').item.json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').item.json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').item.json.SenderJid }}\",\n   \"text\": {{ JSON.stringify($json.reply_to_user) }},\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                12960,
                1984
            ],
            "id": "b657ea9e-ad42-4447-a4be-4f9bd1ae8351",
            "name": "send txt17"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message = $input.first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                12496,
                1984
            ],
            "id": "d64cecf0-600b-4a8e-b949-012228052701",
            "name": "Code12"
        },
        {
            "parameters": {
                "tableId": "queue",
                "fieldsUi": {
                    "fieldValues": [
                        {
                            "fieldId": "sender_id",
                            "fieldValue": "={{ $('Edit Fields').item.json.SenderJid }}"
                        },
                        {
                            "fieldId": "message",
                            "fieldValue": "=latitude: {{ $json.lat }}\nlongitude: {{ $json.lon }}\naddress: {{ $json.display_name }}"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                3584,
                2880
            ],
            "id": "4cef839a-6830-4cb9-a212-31f32a614d0c",
            "name": "Create a row10",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "=HISTORY: User sent a location for checking coverage.\nSYSTEM RESULT: \n- Is Covered: {{ $('Check Coverage3').item.json.covered }}\n- Delivery Fee: {{ $('Check Coverage3').item.json.delivery_fee }}\n- Address Found: {{ $if(\n    $('TO ADDRESS6').isExecuted,\n    $('TO ADDRESS6').item.json.display_name,\n    $('TO ADDRESS4').item.json.display_name\n) }}\n\nINSTRUCTION:\n1. If \"Is Covered\" is TRUE: Tell the user good news, mention the address and fee, and ask what they want to order. (Intent: GENERAL_QUERY or ADD_TO_CART context).\n2. If \"Is Covered\" is FALSE: Apologize politely, state that we don't deliver to [Address Found], and ask if they have another location or want to visit a branch. (Intent: GENERAL_QUERY).\n\nDO NOT output intent \"CHECK_COVERAGE\" again. The check is already done.",
                "options": {
                    "systemMessage": "=\n### 1. IDENTITY & PERSONA\nYou are 'TarwekaBot', the intelligent and friendly waiter for **Tarweka Restaurant (ØªØ±ÙˆÙŠÙ‚Ø©)**.\nYour goal is to collect orders, check delivery coverage, and answer questions using our specific knowledge base.\n\n**Tone:** \n- Professional but warm (Egyptian Hospitality / Ø§Ø¨Ù† Ø¨Ù„Ø¯).\n- Languages: **Egyptian Arabic** (Franco or Script) and **English**.\n- Always reply in the same language the user speaks.\n- **Emoji Usage:** Use emojis freely (ğŸ¥, ğŸ¯, ğŸ›µ, â¤ï¸, ğŸ“).\n\n### 2. THE PRIME DIRECTIVE (CRITICAL)\n1. **JSON ONLY:** You must **NEVER** output conversational text outside of a JSON object.\n2. **NO MARKDOWN:** Do not use code blocks (```json). Output raw JSON only.\n3. **ALWAYS ASK:** Your `reply_to_user` must **ALWAYS** end with a question or call-to-action (unless the order is finalized).\n\n### 3. THE ONBOARDING FLOW (STRICT SEQUENCE)\n1.  **Phase 1: Identity** -> If Name unknown, ask for it.\n2.  **Phase 2: Location** -> If Location unknown, ask for **Location Pin** or **Google Maps Link**.\n3.  **Phase 3: Ordering** -> Only after coverage is confirmed (by the system), take the order.\n\n### 4. KNOWLEDGE BASE & MENU (FACTS ONLY)\n\n#### **A. Branches & Contact**\n- **Phone:** 0248832036 (Unified Number).\n- **Mansoura Branch:** 1st Tor3a St, opposite Mansoura Univ, near Gehan St intersection.\n  - Link: https://maps.app.goo.gl/pf4DMxppTh3y1YuG7\n- **Almaza (Cairo) Branch:** Almaza Park Mall, opposite EgyptAir Hospital, next to Second Cup.\n  - Link: https://maps.app.goo.gl/KnP6pzFdczjHPZxs8\n\n#### **B. Savory Feteer Sizes (Portions)**\n- **Roll (26cm length):** For 1 Person.\n- **Medium (26cm dia):** For 1 Person.\n- **Large (30cm dia):** 2 people (hungry) OR 2-3 people (light eaters).\n- **Family (37cm dia):** 4 people (2 adults + 2 kids).\n\n#### **C. Sweet Feteer (Dessert)**\n- **Sizes:** Rectangular (18x30cm). The Roll version is approx 9x15cm.\n- **Heavy Options:** (Dates/Ibreem, Nutella, Lotus, Kinder) -> These are very filling, suitable for sharing (2-3 people).\n- **Light Options:** Sugar & Milk, Custard.\n\n#### **D. Meshaltet (Traditional)**\n- **Tawriqa Plate:** (3 pcs + 2 dips) -> 1 Person.\n- **Medium:** (+3 dips) -> 1 Hungry Person OR 2 Sharing.\n- **Large:** (+4 dips) -> 2-3 People.\n- **Family:** (+5 dips) -> Family of 4.\n\n#### **E. Common Questions (FAQ)**\n- **Cutting:** We cut all feteer by default. Users can request \"No Cut\" or \"Cut in half\" (for Rolls).\n- **Sauce:** Some are inside, some on top (Ranch/BBQ).\n- **Sausage (Sogo2):** Spices are balanced (not spicy). If user wants Spicy, they must add a note/request it.\n- **Menu Link:** https://tawriqa.com/menu-ar\n\n### 5. INTENT CLASSIFICATION & OUTPUT RULES\nClassify user input into exactly **ONE** intent.\n**CRITICAL:** Only include the `data` fields listed for that specific intent. Do **NOT** output fields with null values.\n\n1.  **`PROVIDE_NAME`**\n    - Trigger: User gives name. Action: Ask for Location.\n    - **Output Data:** `customer_name`.\n\n2.  **`CHECK_COVERAGE`**\n    - Trigger: User sends Google Maps link OR Location Pin.\n    - **Output Data:** `maps_link` (if link) OR `lat` and `lng` (if digits).\n\n3.  **`ADD_TO_CART`**\n    - Trigger: User selects items.\n    - **Logic:** Match items to Menu. Keep cumulative list.\n    - **Output Data:** `items` (Array of {name, qty, price}).\n\n4.  **`CONFIRM_ORDER`**\n    - Trigger: \"Confirm\", \"Place order\", \"ØªÙ…Ø§Ù…\".\n    - **Logic:** Only trigger if items exist in cart history.\n    - **Output Data:** `items`, `customer_name` (if known), `lat` (if known), `lng` (if known).\n\n5.  **`TRACK_ORDER`**\n    - Trigger: \"Status of order #15\".\n    - **Output Data:** `order_id`.\n\n6.  **`MODIFY_ORDER`**\n    - Trigger: \"Change order #50\", \"Add cola to order 10\".\n    - **Output Data:** `order_id`, `new_items`, `notes`.\n\n7.  **`CANCEL_ORDER`**\n    - Trigger: \"Cancel order\".\n    - **Output Data:** `order_id`, `reason`.\n\n8.  **`GENERAL_QUERY`**\n    - Trigger: FAQs (Sizes, Location, Menu), Greetings.\n    - **Output Data:** (Empty Object) `{}`.\n\n### 6. JSON OUTPUT SCHEMA\nYour output must look exactly like this structure, but only including relevant data fields:\n\n```json\n{\n  \"intent\": \"INTENT_NAME\",\n  \"reply_to_user\": \"Response string (Egyptian Arabic/English)\",\n  \"data\": {\n    // Only include fields relevant to the intent. Examples:\n    // \"lat\": 30.0, \"lng\": 31.0\n    // \"items\": [...]\n  }\n}\n```\n\n### 7. EXAMPLES (CONTEXT & CASES)\n\n**Ex 1: Greeting (Unknown Name)**\n*User:* \"Salam Alaykom\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…! Ù…Ù†ÙˆØ± ØªØ±ÙˆÙŠÙ‚Ø© â¤ï¸ Ù…Ù…ÙƒÙ† Ø£ØªØ´Ø±Ù Ø¨Ø§Ø³Ù… Ø­Ø¶Ø±ØªÙƒØŸ\",\n  \"data\": {}\n}\n```\n\n**Ex 2: Name Provided**\n*User:* \"Ahmed Mohamed\"\n*Assistant:*\n```json\n{\n  \"intent\": \"PROVIDE_NAME\",\n  \"reply_to_user\": \"Ø£Ù‡Ù„Ù‹Ø§ ÙŠØ§ Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯! ğŸ” Ø¹Ø´Ø§Ù† Ù†Ø´ÙˆÙ ÙØ±ÙˆØ¹Ù†Ø§ Ø¨ØªÙˆØµÙ„ÙƒØŒ Ù…Ù…ÙƒÙ† ØªØ¨Ø¹Øª Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù† (Location Pin) Ø£Ùˆ Ù„ÙŠÙ†Ùƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŸ\",\n  \"data\": { \"customer_name\": \"Ahmed Mohamed\" }\n}\n```\n\n**Ex 3: Coverage Check (Link)**\n*User:* \"https://maps.google.com/...\"\n*Assistant:*\n```json\n{\n  \"intent\": \"CHECK_COVERAGE\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØºØ·ÙŠØ©... â±ï¸ Ø«ÙˆØ§Ù†ÙŠ ÙˆÙ‡Ø±Ø¯ Ø¹Ù„ÙŠÙƒ.\",\n  \"data\": { \"maps_link\": \"https://maps.google.com/...\" }\n}\n```\n\n**Ex 4: Coverage Check (Pin)**\n*User:* \"Location: 30.044, 31.235\"\n*Assistant:*\n```json\n{\n  \"intent\": \"CHECK_COVERAGE\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†... ğŸ›µ\",\n  \"data\": { \"lat\": 30.044, \"lng\": 31.235 }\n}\n```\n\n**Ex 5: FAQ (Sizes)**\n*User:* \"Ø§Ù„Ø±ÙˆÙ„ Ø¨ÙŠÙƒÙÙŠ ÙƒØ§Ù… ÙˆØ§Ø­Ø¯ØŸ\"\n*Assistant:*\n```json\n{\n  \"intent\": \"GENERAL_QUERY\",\n  \"reply_to_user\": \"ÙØ·ÙŠØ±Ø© Ø§Ù„Ø±ÙˆÙ„ (26 Ø³Ù…) Ø¨ØªÙƒÙÙŠ ÙØ±Ø¯ ÙˆØ§Ø­Ø¯. ğŸŒ¯ ØªØ­Ø¨ ØªØ¬Ø±Ø¨ ÙˆØ§Ø­Ø¯Ø©ØŸ\",\n  \"data\": {}\n}\n```\n\n**Ex 6: Ordering (Complex)**\n*User:* \"Ø¹Ø§ÙŠØ² 2 ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ ÙˆØ³Ø· ÙˆÙˆØ§Ø­Ø¯Ø© Ù†ÙˆØªÙŠÙ„Ø§\"\n*Assistant:*\n```json\n{\n  \"intent\": \"ADD_TO_CART\",\n  \"reply_to_user\": \"ØªÙ…Ø§Ù… ÙŠØ§ ÙÙ†Ø¯Ù…! ğŸ¥ Ø¶ÙŠÙØªÙ„Ùƒ 2 ÙØ·ÙŠØ±Ø© Ø³Ø¬Ù‚ (ÙˆØ³Ø·) Ùˆ 1 Ù†ÙˆØªÙŠÙ„Ø§. ØªØ­Ø¨ ØªØ²ÙˆØ¯ Ø£ÙŠ Ù…Ø´Ø±ÙˆØ¨Ø§ØªØŸ\",\n  \"data\": {\n    \"items\": [ \n      { \"name\": \"Sausage Feteer Medium\", \"qty\": 2, \"price\": 0 }, \n      { \"name\": \"Nutella Feteer\", \"qty\": 1, \"price\": 0 }\n    ] \n  }\n}\n```\n\n**Ex 7: Modification**\n*User:* \"Ù…Ø¹Ù„Ø´ ÙÙŠ Ø£ÙˆØ±Ø¯Ø± Ø±Ù‚Ù… 50ØŒ Ø´ÙŠÙ„ Ø§Ù„Ù†ÙˆØªÙŠÙ„Ø§ ÙˆØ­Ø· Ù„ÙˆØªØ³\"\n*Assistant:*\n```json\n{\n  \"intent\": \"MODIFY_ORDER\",\n  \"reply_to_user\": \"ÙˆÙ„Ø§ ÙŠÙ‡Ù…Ùƒ! Ù‡Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ø¨Ø® Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙˆØ±Ù‹Ø§ (Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù†ÙˆØªÙŠÙ„Ø§ ÙˆØ¥Ø¶Ø§ÙØ© Ù„ÙˆØªØ³). Ø«ÙˆØ§Ù†ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯...\",\n  \"data\": {\n    \"order_id\": 50,\n    \"new_items\": [\n       { \"name\": \"Sausage Feteer Medium\", \"qty\": 2, \"price\": 0 },\n       { \"name\": \"Lotus Feteer\", \"qty\": 1, \"price\": 0 }\n    ],\n    \"notes\": \"Replace Nutella with Lotus\"\n  }\n}\n```\n```"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3,
            "position": [
                11248,
                2000
            ],
            "id": "9936661f-ef5c-46db-93ac-74ef8cf3feb4",
            "name": "AI Agent5"
        },
        {
            "parameters": {
                "url": "=https://geocode.maps.co/reverse?lat={{ $('Code in JavaScript7').item.json.data.lat }}&lon={{ $('Code in JavaScript7').item.json.data.lng }}&api_key=692791e53d275820577939xlc48e891",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                10608,
                1952
            ],
            "id": "19fc525c-98e3-440b-aa90-ae5d7e6c738f",
            "name": "TO ADDRESS6"
        },
        {
            "parameters": {
                "operation": "get",
                "tableId": "customer_addresses",
                "filters": {
                    "conditions": [
                        {
                            "keyName": "customer_id",
                            "keyValue": "={{ $('Switch').item.json.result.customer.id }}"
                        },
                        {
                            "keyName": "is_default",
                            "keyValue": "true"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                9632,
                2896
            ],
            "id": "402bfe03-44de-4bc9-809a-8ffe66d55fd0",
            "name": "Get a row1",
            "credentials": {
                "supabaseApi": {
                    "id": "i1g0cyegbmco4FAf",
                    "name": "dr.gimy 7 tarweka"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://tarwekaapi.ai4eg.com/api/orders",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "my_super_secret_n8n_password"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"customer_id\": {{ $('Switch').first().json.result.customer.id }},\n  \"address_id\": {{ $json.data.address_id }},\n  \"items\":  {{ $('Code in JavaScript7').item.json.data.items.toJsonString() }}\n} ",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                8848,
                2416
            ],
            "id": "048e050f-85f3-48f8-bbbe-b100121226de",
            "name": "HTTP Request14"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').first().json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').first().json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').first().json.SenderJid }}\",\n    \"text\": \"{{ JSON.stringify($json.typingAnalysis.originalMessage).slice(1, -1)}}  Ø±Ù‚Ù… Ø§Ù„Ø§ÙˆØ±Ø¯Ø± : {{ $json.order_id }}\",\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                9552,
                2416
            ],
            "id": "fc957f75-d603-43c0-ab76-a23563577a4d",
            "name": "send txt18"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message =  $('Code in JavaScript7').first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                9280,
                2416
            ],
            "id": "197bd4dc-df88-4b9c-8030-2ad1764d7bfd",
            "name": "Code13"
        },
        {
            "parameters": {
                "mode": "insert",
                "messages": {
                    "messageValues": [
                        {
                            "type": "ai",
                            "message": "=order id :  {{ $('HTTP Request14').item.json.order_id }}\norder items: {{ $('Code in JavaScript7').item.json.data.items.toJsonString() }}\ntotal price : {{ $('HTTP Request14').item.json.total_price }} \n"
                        }
                    ]
                }
            },
            "type": "@n8n/n8n-nodes-langchain.memoryManager",
            "typeVersion": 1.1,
            "position": [
                9856,
                2416
            ],
            "id": "b675cb13-4c65-4521-aa50-309d11a0824c",
            "name": "Chat Memory Manager1"
        },
        {
            "parameters": {
                "operation": "executeQuery",
                "query": "SELECT get_customer_context($1) as result;",
                "options": {
                    "queryReplacement": "={{ $json.phonenumber }}"
                }
            },
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 2.6,
            "position": [
                96,
                2336
            ],
            "id": "47225217-3725-4440-9f20-72e45c28c150",
            "name": "Execute a SQL query",
            "credentials": {
                "postgres": {
                    "id": "7t4sL9T7mUlwFi06",
                    "name": "Postgres account 3"
                }
            }
        },
        {
            "parameters": {
                "url": "=https://geocode.maps.co/reverse?lat={{ $('Code in JavaScript8').item.json.latitude }}&lon={{ $('Code in JavaScript8').item.json.longitude }}&api_key=692791e53d275820577939xlc48e891",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                10688,
                2288
            ],
            "id": "921360e7-894c-49f0-a1aa-6349fb991d1c",
            "name": "TO ADDRESS3"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').first().json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').first().json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').first().json.SenderJid }}\",\n    \"text\": \"{{ JSON.stringify($json.reply_to_user).slice(1, -1) }}\",\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                8944,
                2560
            ],
            "id": "bf76d365-64ab-42eb-bcc2-a761faefd26c",
            "name": "send txt"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message = $input.first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                8592,
                2560
            ],
            "id": "1a66dd70-2537-406d-b9f8-6f958e99fb4e",
            "name": "Code7"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://tarwekaapi.ai4eg.com/api/orders/{{ $('Code7').item.json.data.order_id }}/modify ",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "my_super_secret_n8n_password"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "notes",
                            "value": "={{ $('Code in JavaScript7').item.json.data.notes }}"
                        },
                        {
                            "name": "items",
                            "value": "={{ $('Code in JavaScript7').item.json.data.new_items }}"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                9248,
                2560
            ],
            "id": "144d6df5-8261-48d5-b018-e09bc2b337bf",
            "name": "HTTP Request16"
        },
        {
            "parameters": {
                "jsCode": "// 1. Get User Message (Clean Text)\n// We get this from the transcription or aggregation node\nconst userMessage = $('Code6').first().json.body;\n\n// 2. Get Data from SQL Node\n// We safely handle if the data is wrapped in 'result' or comes direct\nconst rawSql = $('Execute a SQL query').first().json;\nconst data = rawSql.result || rawSql.get_customer_context || rawSql;\n\n// 3. Build The Dynamic System Context\n// This string will be injected into the AI's \"Brain\" (System Prompt)\nlet contextText = \"\";\n\nif (!data || data.found === false) {\n  // Case: New User\n  contextText = \"CURRENT USER CONTEXT:\\n- Status: NEW CUSTOMER\\n- Instruction: Welcome them warmly and ask for their Name.\";\n} else {\n  // Case: Existing User\n  contextText = `CURRENT USER CONTEXT:\\n`;\n  contextText += `- Name: ${data.customer.full_name}\\n`;\n  contextText += `- Customer DB ID: ${data.customer.id}\\n`;\n\n  // A. Active Order Check\n  if (data.active_order) {\n    contextText += `\\nâš ï¸ ACTIVE ORDER FOUND:\\n`;\n    contextText += `- Order ID: #${data.active_order.id}\\n`;\n    contextText += `- Status: ${data.active_order.status}\\n`;\n    contextText += `- Items: ${JSON.stringify(data.active_order.items)}\\n`;\n    contextText += `INSTRUCTION: If user asks about status/changes, refer to this order.\\n`;\n  } else {\n    contextText += `- Active Orders: None.\\n`;\n  }\n\n  // B. Address List\n  if (data.addresses && Array.isArray(data.addresses) && data.addresses.length > 0) {\n    contextText += `\\nSAVED ADDRESSES (User can choose by number):\\n`;\n    data.addresses.forEach((addr, index) => {\n      // Map Index (1, 2) to DB ID\n      contextText += `  ${index + 1}. ${addr.address_text} (ID: ${addr.id})\\n`;\n    });\n    contextText += `INSTRUCTION: If user selects an address, use the ID provided.\\n`;\n  } else {\n    contextText += `\\nSAVED ADDRESSES: None. (Ask for Location Pin or Link).\\n`;\n  }\n}\n\n// 4. Output Separated Fields\nreturn [{\n  json: {\n    // 1. The pure message the user sent\n    user_message: userMessage,\n    \n    // 2. The background info the AI needs to know\n    system_context: contextText,\n    \n    // 3. IDs passed through for the Router/Execution nodes later\n    customer_id: (data && data.found) ? data.customer.id : null,\n    active_order_id: (data && data.active_order) ? data.active_order.id : null\n  }\n}];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                6272,
                2624
            ],
            "id": "6ad7167f-51f1-414f-a27f-e9e71eecfac0",
            "name": "Code in JavaScript11"
        },
        {
            "parameters": {
                "model": "x-ai/grok-4.1-fast",
                "options": {
                    "responseFormat": "json_object",
                    "temperature": 0.5
                }
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
            "typeVersion": 1,
            "position": [
                7664,
                3328
            ],
            "id": "e081fe7e-af8c-4aa9-98e6-d496044110f7",
            "name": "OpenRouter Chat Model",
            "credentials": {
                "openRouterApi": {
                    "id": "JLb7Ok4RGafFLUVG",
                    "name": "mostafa"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "=https://evo.ai4eg.com/message/sendText/{{ $('Webhook').first().json.body.instance }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "=apikey",
                            "value": "={{ $('Edit Fields').first().json.Key }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n    \"number\": \"{{ $('Edit Fields').first().json.SenderJid }}\",\n    \"text\": \"{{ JSON.stringify($json.reply_to_user).slice(1, -1) }}\",\n    \"delay\":{{ $json.typingAnalysis.calculatedTimeMs }}\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                8704,
                2720
            ],
            "id": "f3ac02a5-89b4-477b-b676-c350dfd6ce35",
            "name": "send txt1"
        },
        {
            "parameters": {
                "jsCode": "/**\n * n8n Code Node: Typing Time Calculator\n *\n * This node simulates the time it would take for a human to type a message.\n * It takes an incoming message, counts the characters, and for each character,\n * it calculates a random delay within a specified range.\n *\n * HOW TO USE:\n * 1. Copy and paste this entire code into an n8n \"Code\" node.\n * 2. Make sure the input data for this node has a property containing the message you want to analyze.\n * By default, this code looks for `items[0].json.message`. You may need to change\n * `item.json.message` to match your actual incoming data structure (e.g., `item.json.text`).\n * 3. Adjust the `minTimePerChar` and `maxTimePerChar` variables below to set your desired time range.\n */\n\n// --- Configuration ---\n// Set the minimum time (in milliseconds) it takes to type one character.\nconst minTimePerChar = 20;\n\n// Set the maximum time (in milliseconds) it takes to type one character.\nconst maxTimePerChar = 50;\n// -------------------\n\n// The n8n Code node executes this code for all incoming items.\n// We will loop through each item, perform the calculation, and return it with the new data.\nfor (const item of items) {\n  // Get the message from the incoming item's JSON data.\n  // IMPORTANT: Change 'message' if your field is named something else (e.g., 'text', 'body').\n  // The '|| \"\"' part ensures that if the message field doesn't exist, we use an empty string to avoid errors.\n  const message = $input.first().json.reply_to_user || '';\n\n  // Get the total number of characters in the message.\n  const characterCount = message.length;\n\n  // Initialize total time to 0.\n  let totalTypingTime = 0;\n\n  // Loop through each character of the message to calculate the time.\n  for (let i = 0; i < characterCount; i++) {\n    // Generate a random typing time for this specific character.\n    // The time will be between minTimePerChar and maxTimePerChar.\n    const randomTimeForChar = Math.random() * (maxTimePerChar - minTimePerChar) + minTimePerChar;\n    \n    // Add this character's time to the total.\n    totalTypingTime += randomTimeForChar;\n  }\n\n  // Add the calculated results to the item's JSON data.\n  // The original data from the item will be preserved.\n  item.json.typingAnalysis = {\n    characterCount: characterCount,\n    // We use Math.round() to get a clean integer value for the total time.\n    calculatedTimeMs: Math.round(totalTypingTime),\n    originalMessage: message,\n  };\n}\n\n// Return all the processed items to be used in the next nodes.\nreturn items;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                8352,
                2720
            ],
            "id": "980bec0a-a034-4c8f-a3c0-b1f4e3b9cc13",
            "name": "Code8"
        },
        {
            "parameters": {
                "method": "PATCH",
                "url": "=https://tarwekaapi.ai4eg.com/api/orders/{{ $('Code in JavaScript7').item.json.data.order_id }}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "my_super_secret_n8n_password"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "status",
                            "value": "cancelled"
                        },
                        {
                            "name": "cancellation_reason",
                            "value": "={{ $('Switch3').item.json.data.reason }}"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
                9056,
                2720
            ],
            "id": "0654c3e0-95ce-484b-9d50-d2060a3353d8",
            "name": "HTTP Request18"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://evo.ai4eg.com/chat/getBase64FromMediaMessage/n8n",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "={{ $('Webhook').item.json.body.apikey }}"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $('Webhook').item.json.body.data.key.id }}\"\n    }\n  }\n} ",
                "options": {
                    "response": {}
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                2192,
                2384
            ],
            "id": "27fd79fb-3bbc-4ab3-9346-f6f273a321cb",
            "name": "HTTP Request19"
        },
        {
            "parameters": {
                "jsCode": "// Loop through all incoming items\nfor (const item of items) {\n  // Safe access to data structure\n  const body = item.json.body || {};\n  const data = body.data || {};\n  const key = data.key || {};\n  const message = data.message || {};\n\n  // 1. Logic to get the JID with 's.whatsapp.net'\n  let correctJid = '';\n  \n  if (key.remoteJid && key.remoteJid.includes('s.whatsapp.net')) {\n    correctJid = key.remoteJid;\n  } else if (key.remoteJidAlt && key.remoteJidAlt.includes('s.whatsapp.net')) {\n    correctJid = key.remoteJidAlt;\n  } else {\n    // Fallback if neither has it, default to remoteJid\n    correctJid = key.remoteJid || '';\n  }\n\n  // 2. Extract the phone number (everything before the @)\n  const phoneNumber = correctJid.split('@')[0];\n\n  // 3. Handle Timestamp (Standard JS, convert Seconds to Date + 3 Hours for UTC+3)\n  let formattedTime = '';\n  if (data.messageTimestamp) {\n    // Timestamp is in seconds, multiply by 1000 for milliseconds\n    const date = new Date(data.messageTimestamp * 1000);\n    // Add 3 hours in milliseconds (3 * 60 * 60 * 1000 = 10800000)\n    const utc3Date = new Date(date.getTime() + 10800000);\n    // Convert to ISO string for consistency\n    formattedTime = utc3Date.toISOString().replace('T', ' ').replace('Z', '');\n  }\n\n  // 4. Construct the Output JSON\n  item.json = {\n    SenderJid: correctJid,\n    SenderName: data.pushName,\n    Timestamp: formattedTime,\n    MsgType: data.messageType,\n    Msg: message.conversation,\n    Media: message.base64, // Will be undefined if not present, which is fine\n    Instance: body.instance,\n    Key: body.apikey,\n    phonenumber: phoneNumber\n  };\n}\n\nreturn items;"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -592,
                2336
            ],
            "id": "6d4a5af6-92d1-4c11-914b-bec6119e8946",
            "name": "Code in JavaScript6"
        },
        {
            "parameters": {
                "model": "x-ai/grok-4.1-fast",
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
            "typeVersion": 1,
            "position": [
                3440,
                2800
            ],
            "id": "79249602-e9cf-4c1d-a742-0ed922e4ca3d",
            "name": "OpenRouter Chat Model1",
            "credentials": {
                "openRouterApi": {
                    "id": "JLb7Ok4RGafFLUVG",
                    "name": "mostafa"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://openrouter.ai/api/v1/chat/completions",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Authorization",
                            "value": "Bearer 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"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"model\": \"google/gemini-2.5-flash\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"Please transcribe this audio file.\"\n        },\n        {\n          \"type\": \"input_audio\",\n          \"input_audio\": {\n            \"data\": \"{{ $json.base64 }}\",\n            \"format\": \"ogg\"\n          }\n        }\n      ]\n    }\n  ]\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                2752,
                2048
            ],
            "id": "e17d6906-ee99-43a0-90c0-f77ab70bbb99",
            "name": "transcribe1"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://openrouter.ai/api/v1/chat/completions",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Authorization",
                            "value": "Bearer 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"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"model\": \"google/gemini-2.5-flash\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"Please transcribe this audio file.\"\n        },\n        {\n          \"type\": \"input_audio\",\n          \"input_audio\": {\n            \"data\": \"{{ $json.base64 }}\",\n            \"format\": \"ogg\"\n          }\n        }\n      ]\n    }\n  ]\n} ",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                2432,
                2080
            ],
            "id": "9aa816d1-444c-41ff-9d37-1cc46c32c192",
            "name": "transcribe2"
        },
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "callback",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
                -1680,
                3056
            ],
            "id": "9d172157-960f-47e7-b996-8fbba87ba353",
            "name": "Webhook1",
            "webhookId": "80f0577a-415f-4985-b851-8ae8bc755f65"
        }
    ],
    "connections": {
        "Webhook": {
            "main": [
                [
                    {
                        "node": "If",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Wait": {
            "main": [
                [
                    {
                        "node": "Create a row2",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row2": {
            "main": [
                [
                    {
                        "node": "Edit Fields4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "transcribe": {
            "main": [
                [
                    {
                        "node": "Create a row3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row3": {
            "main": [
                [
                    {
                        "node": "Edit Fields4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Edit Fields4": {
            "main": [
                [
                    {
                        "node": "Wait4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Convert to File2": {
            "main": [
                [
                    {
                        "node": "Read/Write Files from Disk2",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Read/Write Files from Disk2": {
            "main": [
                [
                    {
                        "node": "Basic LLM Chain",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row6": {
            "main": [
                [
                    {
                        "node": "Edit Fields4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Basic LLM Chain": {
            "main": [
                [
                    {
                        "node": "Create a row6",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Google Gemini Chat Model1": {
            "ai_languageModel": [
                []
            ]
        },
        "Sort": {
            "main": [
                [
                    {
                        "node": "If5",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If5": {
            "main": [
                [
                    {
                        "node": "Delete a row1",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "No Operation, do nothing1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Wait4": {
            "main": [
                [
                    {
                        "node": "Get many rows1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get many rows1": {
            "main": [
                [
                    {
                        "node": "Sort",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Aggregate2": {
            "main": [
                [
                    {
                        "node": "Code6",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code6": {
            "main": [
                [
                    {
                        "node": "Code in JavaScript9",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Delete a row1": {
            "main": [
                [
                    {
                        "node": "Aggregate2",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "HTTP Request8": {
            "main": [
                [
                    {
                        "node": "Convert to File2",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If": {
            "main": [
                [
                    {
                        "node": "No Operation, do nothing",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Code in JavaScript6",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Edit Fields": {
            "main": [
                [
                    {
                        "node": "Execute a SQL query",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If1": {
            "main": [
                [
                    {
                        "node": "Create a row",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Switch",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row": {
            "main": [
                [
                    {
                        "node": "Switch",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Switch": {
            "main": [
                [
                    {
                        "node": "Wait",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "HTTP Request19",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "HTTP Request8",
                        "type": "main",
                        "index": 0
                    }
                ],
                [],
                [
                    {
                        "node": "Check Coverage4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "AI Agent3": {
            "main": [
                [
                    {
                        "node": "Code in JavaScript7",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code in JavaScript7": {
            "main": [
                [
                    {
                        "node": "Switch3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Switch3": {
            "main": [
                [
                    {
                        "node": "Update a row",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Code",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Code5",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "HTTP Request14",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Code7",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Code8",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "HTTP Request10": {
            "main": [
                [
                    {
                        "node": "Code in JavaScript8",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code in JavaScript8": {
            "main": [
                [
                    {
                        "node": "Check Coverage1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If2": {
            "main": [
                [
                    {
                        "node": "TO ADDRESS2",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "TO ADDRESS3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Check Coverage1": {
            "main": [
                [
                    {
                        "node": "If2",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code in JavaScript9": {
            "main": [
                [
                    {
                        "node": "AI Agent3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If4": {
            "main": [
                [
                    {
                        "node": "HTTP Request10",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Check Coverage3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Check Coverage3": {
            "main": [
                [
                    {
                        "node": "If7",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If7": {
            "main": [
                [
                    {
                        "node": "TO ADDRESS4",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "TO ADDRESS6",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Update a row": {
            "main": [
                [
                    {
                        "node": "Code11",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "send txt3": {
            "main": [
                [
                    {
                        "node": "If4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row4": {
            "main": [
                [
                    {
                        "node": "AI Agent4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "TO ADDRESS2": {
            "main": [
                [
                    {
                        "node": "Create a row4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row8": {
            "main": [
                [
                    {
                        "node": "AI Agent5",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "TO ADDRESS4": {
            "main": [
                [
                    {
                        "node": "Create a row8",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code": {
            "main": [
                [
                    {
                        "node": "send txt3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code5": {
            "main": [
                [
                    {
                        "node": "send txt7",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Postgres Chat Memory": {
            "ai_memory": [
                [
                    {
                        "node": "AI Agent3",
                        "type": "ai_memory",
                        "index": 0
                    },
                    {
                        "node": "Chat Memory Manager1",
                        "type": "ai_memory",
                        "index": 0
                    },
                    {
                        "node": "AI Agent4",
                        "type": "ai_memory",
                        "index": 0
                    },
                    {
                        "node": "AI Agent5",
                        "type": "ai_memory",
                        "index": 0
                    }
                ]
            ]
        },
        "Check Coverage4": {
            "main": [
                [
                    {
                        "node": "If8",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "If8": {
            "main": [
                [
                    {
                        "node": "TO ADDRESS5",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "TO ADDRESS5",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "TO ADDRESS5": {
            "main": [
                [
                    {
                        "node": "Create a row10",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code11": {
            "main": [
                [
                    {
                        "node": "send txt15",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "AI Agent4": {
            "main": [
                [
                    {
                        "node": "Code in JavaScript10",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code in JavaScript10": {
            "main": [
                [
                    {
                        "node": "Code12",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code12": {
            "main": [
                [
                    {
                        "node": "send txt17",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Create a row10": {
            "main": [
                [
                    {
                        "node": "Edit Fields4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "AI Agent5": {
            "main": [
                [
                    {
                        "node": "Code in JavaScript10",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "TO ADDRESS6": {
            "main": [
                [
                    {
                        "node": "AI Agent5",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get a row1": {
            "main": [
                []
            ]
        },
        "HTTP Request14": {
            "main": [
                [
                    {
                        "node": "Code13",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "send txt18": {
            "main": [
                [
                    {
                        "node": "Chat Memory Manager1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code13": {
            "main": [
                [
                    {
                        "node": "send txt18",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Execute a SQL query": {
            "main": [
                [
                    {
                        "node": "If1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "TO ADDRESS3": {
            "main": [
                [
                    {
                        "node": "AI Agent4",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "send txt": {
            "main": [
                [
                    {
                        "node": "HTTP Request16",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code7": {
            "main": [
                [
                    {
                        "node": "send txt",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "OpenRouter Chat Model": {
            "ai_languageModel": [
                [
                    {
                        "node": "AI Agent3",
                        "type": "ai_languageModel",
                        "index": 1
                    },
                    {
                        "node": "AI Agent3",
                        "type": "ai_languageModel",
                        "index": 0
                    },
                    {
                        "node": "AI Agent4",
                        "type": "ai_languageModel",
                        "index": 0
                    },
                    {
                        "node": "AI Agent5",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "send txt1": {
            "main": [
                [
                    {
                        "node": "HTTP Request18",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code8": {
            "main": [
                [
                    {
                        "node": "send txt1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "HTTP Request19": {
            "main": [
                [
                    {
                        "node": "transcribe",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code in JavaScript6": {
            "main": [
                [
                    {
                        "node": "Edit Fields",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "OpenRouter Chat Model1": {
            "ai_languageModel": [
                [
                    {
                        "node": "Basic LLM Chain",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "pinData": {
        "Webhook": [
            {
                "headers": {
                    "host": "n8n.asra3.com",
                    "x-real-ip": "172.70.246.200",
                    "x-forwarded-for": "152.53.146.113, 172.70.246.200",
                    "x-forwarded-proto": "https",
                    "connection": "Upgrade",
                    "content-length": "1517",
                    "accept": "application/json, text/plain, */*",
                    "accept-encoding": "gzip, br",
                    "user-agent": "axios/1.12.2",
                    "cf-ray": "9ba5bc36d8281e4d-FRA",
                    "content-type": "application/json",
                    "cdn-loop": "cloudflare; loops=1",
                    "cf-connecting-ip": "152.53.146.113",
                    "cf-ipcountry": "DE",
                    "cf-visitor": "{\"scheme\":\"https\"}"
                },
                "params": {},
                "query": {},
                "body": {
                    "event": "messages.upsert",
                    "instance": "n8n",
                    "data": {
                        "key": {
                            "remoteJid": "173422726385840@lid",
                            "remoteJidAlt": "971504798759@s.whatsapp.net",
                            "fromMe": false,
                            "id": "3A59FC17D5F2A8D24032",
                            "participant": "",
                            "addressingMode": "lid"
                        },
                        "pushName": "Dr Mostafa Alaa",
                        "status": "DELIVERY_ACK",
                        "message": {
                            "messageContextInfo": {
                                "deviceListMetadata": {
                                    "senderKeyIndexes": [],
                                    "recipientKeyIndexes": [],
                                    "senderKeyHash": {
                                        "0": 177,
                                        "1": 235,
                                        "2": 171,
                                        "3": 157,
                                        "4": 119,
                                        "5": 251,
                                        "6": 129,
                                        "7": 138,
                                        "8": 254,
                                        "9": 195
                                    },
                                    "senderTimestamp": {
                                        "low": 1767736567,
                                        "high": 0,
                                        "unsigned": true
                                    },
                                    "recipientKeyHash": {
                                        "0": 59,
                                        "1": 105,
                                        "2": 54,
                                        "3": 47,
                                        "4": 155,
                                        "5": 96,
                                        "6": 4,
                                        "7": 231,
                                        "8": 78,
                                        "9": 120
                                    },
                                    "recipientTimestamp": {
                                        "low": 1766793650,
                                        "high": 0,
                                        "unsigned": true
                                    }
                                },
                                "deviceListMetadataVersion": 2,
                                "messageSecret": {
                                    "0": 165,
                                    "1": 185,
                                    "2": 166,
                                    "3": 39,
                                    "4": 88,
                                    "5": 12,
                                    "6": 44,
                                    "7": 208,
                                    "8": 146,
                                    "9": 218,
                                    "10": 181,
                                    "11": 17,
                                    "12": 132,
                                    "13": 1,
                                    "14": 238,
                                    "15": 37,
                                    "16": 182,
                                    "17": 241,
                                    "18": 180,
                                    "19": 25,
                                    "20": 201,
                                    "21": 65,
                                    "22": 180,
                                    "23": 184,
                                    "24": 59,
                                    "25": 19,
                                    "26": 142,
                                    "27": 79,
                                    "28": 78,
                                    "29": 53,
                                    "30": 8,
                                    "31": 153
                                }
                            },
                            "conversation": "Ù‡Ù„Ø§"
                        },
                        "contextInfo": {
                            "mentionedJid": [],
                            "groupMentions": [],
                            "entryPointConversionSource": "phone_number_hyperlink"
                        },
                        "messageType": "conversation",
                        "messageTimestamp": 1767812816,
                        "instanceId": "1301c752-f91c-4f00-9551-503e2aefaf8d",
                        "source": "ios"
                    },
                    "destination": "https://n8n.asra3.com/webhook/80f0577a-415f-4985-b851-8ae8bc755f65",
                    "date_time": "2026-01-07T16:06:56.359Z",
                    "sender": "6283879144543@s.whatsapp.net",
                    "server_url": "http://152.53.146.113:8080",
                    "apikey": "1E8EAFB6EF97-4C5D-8D20-EF8C7F84A82B"
                },
                "webhookUrl": "https://n8n.asra3.com/webhook/80f0577a-415f-4985-b851-8ae8bc755f65",
                "executionMode": "production"
            }
        ],
        "send txt3": [
            {
                "key": {
                    "remoteJid": "971504798759@s.whatsapp.net",
                    "fromMe": true,
                    "id": "3EB024323668E3AAA39970"
                },
                "pushName": "VocÃª",
                "status": "PENDING",
                "message": {
                    "conversation": "ØªÙ…Ø§Ù… ÙŠØ§ Ø¯ÙƒØªÙˆØ± Ù…ØµØ·ÙÙ‰! ğŸ“ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¯Ù‡ ÙƒÙ…Ø§Ù† Ù„Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„. Ù„Ø­Ø¸Ø§Øª ÙˆÙ‡Ø±Ø¯ Ø¹Ù„Ù‰ Ø­Ø¶Ø±ØªÙƒ. ğŸ›µ"
                },
                "contextInfo": {
                    "mentionedJid": [],
                    "groupMentions": [],
                    "ephemeralSettingTimestamp": {
                        "low": 1765746420,
                        "high": 0,
                        "unsigned": false
                    },
                    "disappearingMode": {
                        "initiator": 0
                    }
                },
                "messageType": "conversation",
                "messageTimestamp": 1765919220,
                "instanceId": "1301c752-f91c-4f00-9551-503e2aefaf8d",
                "source": "web"
            }
        ],
        "Code": [
            {
                "intent": "CHECK_COVERAGE",
                "reply_to_user": "ØªÙ…Ø§Ù… ÙŠØ§ Ø¯ÙƒØªÙˆØ± Ù…ØµØ·ÙÙ‰! ğŸ“ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¯Ù‡ ÙƒÙ…Ø§Ù† Ù„Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„. Ù„Ø­Ø¸Ø§Øª ÙˆÙ‡Ø±Ø¯ Ø¹Ù„Ù‰ Ø­Ø¶Ø±ØªÙƒ. ğŸ›µ",
                "data": {
                    "maps_link": "https://maps.app.goo.gl/wfiaxubDZDCBQR8J6?g_st=ic"
                },
                "typingAnalysis": {
                    "characterCount": 107,
                    "calculatedTimeMs": 3708,
                    "originalMessage": "ØªÙ…Ø§Ù… ÙŠØ§ Ø¯ÙƒØªÙˆØ± Ù…ØµØ·ÙÙ‰! ğŸ“ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¯Ù‡ ÙƒÙ…Ø§Ù† Ù„Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„. Ù„Ø­Ø¸Ø§Øª ÙˆÙ‡Ø±Ø¯ Ø¹Ù„Ù‰ Ø­Ø¶Ø±ØªÙƒ. ğŸ›µ"
                }
            }
        ],
        "Webhook1": [
            {
                "headers": {
                    "host": "n8n.asra3.com",
                    "x-real-ip": "172.70.246.200",
                    "x-forwarded-for": "152.53.146.113, 172.70.246.200",
                    "x-forwarded-proto": "https",
                    "connection": "Upgrade",
                    "content-length": "1517",
                    "accept": "application/json, text/plain, */*",
                    "accept-encoding": "gzip, br",
                    "user-agent": "axios/1.12.2",
                    "cf-ray": "9ba5bc36d8281e4d-FRA",
                    "content-type": "application/json",
                    "cdn-loop": "cloudflare; loops=1",
                    "cf-connecting-ip": "152.53.146.113",
                    "cf-ipcountry": "DE",
                    "cf-visitor": "{\"scheme\":\"https\"}"
                },
                "params": {},
                "query": {},
                "body": {
                    "event": "messages.upsert",
                    "instance": "n8n",
                    "data": {
                        "key": {
                            "remoteJid": "173422726385840@lid",
                            "remoteJidAlt": "971504798759@s.whatsapp.net",
                            "fromMe": false,
                            "id": "3A59FC17D5F2A8D24032",
                            "participant": "",
                            "addressingMode": "lid"
                        },
                        "pushName": "Dr Mostafa Alaa",
                        "status": "DELIVERY_ACK",
                        "message": {
                            "messageContextInfo": {
                                "deviceListMetadata": {
                                    "senderKeyIndexes": [],
                                    "recipientKeyIndexes": [],
                                    "senderKeyHash": {
                                        "0": 177,
                                        "1": 235,
                                        "2": 171,
                                        "3": 157,
                                        "4": 119,
                                        "5": 251,
                                        "6": 129,
                                        "7": 138,
                                        "8": 254,
                                        "9": 195
                                    },
                                    "senderTimestamp": {
                                        "low": 1767736567,
                                        "high": 0,
                                        "unsigned": true
                                    },
                                    "recipientKeyHash": {
                                        "0": 59,
                                        "1": 105,
                                        "2": 54,
                                        "3": 47,
                                        "4": 155,
                                        "5": 96,
                                        "6": 4,
                                        "7": 231,
                                        "8": 78,
                                        "9": 120
                                    },
                                    "recipientTimestamp": {
                                        "low": 1766793650,
                                        "high": 0,
                                        "unsigned": true
                                    }
                                },
                                "deviceListMetadataVersion": 2,
                                "messageSecret": {
                                    "0": 165,
                                    "1": 185,
                                    "2": 166,
                                    "3": 39,
                                    "4": 88,
                                    "5": 12,
                                    "6": 44,
                                    "7": 208,
                                    "8": 146,
                                    "9": 218,
                                    "10": 181,
                                    "11": 17,
                                    "12": 132,
                                    "13": 1,
                                    "14": 238,
                                    "15": 37,
                                    "16": 182,
                                    "17": 241,
                                    "18": 180,
                                    "19": 25,
                                    "20": 201,
                                    "21": 65,
                                    "22": 180,
                                    "23": 184,
                                    "24": 59,
                                    "25": 19,
                                    "26": 142,
                                    "27": 79,
                                    "28": 78,
                                    "29": 53,
                                    "30": 8,
                                    "31": 153
                                }
                            },
                            "conversation": "Ù‡Ù„Ø§"
                        },
                        "contextInfo": {
                            "mentionedJid": [],
                            "groupMentions": [],
                            "entryPointConversionSource": "phone_number_hyperlink"
                        },
                        "messageType": "conversation",
                        "messageTimestamp": 1767812816,
                        "instanceId": "1301c752-f91c-4f00-9551-503e2aefaf8d",
                        "source": "ios"
                    },
                    "destination": "https://n8n.asra3.com/webhook/80f0577a-415f-4985-b851-8ae8bc755f65",
                    "date_time": "2026-01-07T16:06:56.359Z",
                    "sender": "6283879144543@s.whatsapp.net",
                    "server_url": "http://152.53.146.113:8080",
                    "apikey": "1E8EAFB6EF97-4C5D-8D20-EF8C7F84A82B"
                },
                "webhookUrl": "https://n8n.asra3.com/webhook/80f0577a-415f-4985-b851-8ae8bc755f65",
                "executionMode": "production"
            }
        ]
    },
    "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "c522d6cf09b0723c95e34292cfbafc5cdf9b6368e7bfb1a7b64562f91c23ca99"
    }
}